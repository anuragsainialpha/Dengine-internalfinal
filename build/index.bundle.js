parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"yaW9":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("winston"));require("express-async-errors");const{combine:n,timestamp:a,label:l,printf:o}=t.default.format,s=o(({level:e,message:t,label:n,timestamp:a})=>`${a} [${n}] ${e}: ${t}`);function r(){t.default.exceptions.handle(new t.default.transports.File({filename:"uncaughtExceptions.log",handleExceptions:!1})),process.on("unhandledRejection",e=>{throw e}),t.default.add(new t.default.transports.File({filename:"logfile.log",format:n(l({label:"Dengine"}),a(),s)})),"production"!==process.env.NODE_ENV&&t.default.add(new t.default.transports.Console({format:t.default.format.simple()}))}exports.default=r;
},{}],"irtd":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getTC=exports.getSequence=exports.getXID=exports.getDomainName=exports.asyncRouteHandler=exports.convertPath=exports.getSidebar=exports.getViewUrl=exports.getReportUrl=exports.generateAuthToken=exports.asyncHandler=exports.NAME=exports.getXMlVersion=exports.capitalize=exports.getFileData=exports.CONSTS=void 0;const t=e(require("fs")),a=e(require("util")),n=e(require("config")),i=e(require("jsonwebtoken")),o=e(require("random-string-generator")),r=a.default.promisify(t.default.readFile),s=e=>["user","settings","transmission",...e.split(",").map(g())];exports.CONSTS={JWT_PRIVATE_KEY:"production"===process.env.NODE_ENV?(0,o.default)("alphanumeric"):"sfeefv",DB:n.default.get("db"),DEV_INSTANCEURL:n.default.get("devInstanceURL"),TEST_INSTANCEURL:n.default.get("testInstanceURL"),PROD_INSTANCEURL:n.default.get("prodInstanceURL"),GTMVERSION:n.default.get("gtmVersion"),CURRENT_INSTANCE:n.default.get("currentInstance"),IS_CLIENT:n.default.get("isClient"),SCHEMA_URI:n.default.get("schemaURI"),CLIENT_TOKEN:n.default.get("clientToken"),SUBSCIPTION:s(n.default.get("subsciption"))};const c=async e=>await r(e,"UTF-8");exports.getFileData=c;const m=e=>e.toLowerCase().replace(/\b./g,function(e){return e.toUpperCase()});exports.capitalize=m;const l=e=>{const t=e.match(/xmlns="(.*?)"/),a=e.match(/otm="(.*?)"/),n=e.match(/gtm="(.*?)"/);if(!t)return{gtmVersion:null,xmlNsOtm:null,xmlNsGtm:null};const i=t[1].split("v");return{gtmVersion:+i[i.length-1],xmlNsOtm:a[1],xmlNsGtm:n[1]}};exports.getXMlVersion=l,exports.NAME={release:{Source_Location_Domain_Name:"Source Location DomainName",Source_Location_ID:"Source Location ID",Destination_Location_Domain_Name:"Destination Location DomainName",Destination_Location_ID:"Destination Location ID",Order_Configuration:"Order Configuration",Line_Item_Domain_Name:"Line Item DomainName",Line_Item_ID:"Line Item ID"},location:{AddressLine:"Address Line",AddressLineSequenceNumber:"Address Line Sequence Number"},party:{Location_ID_Domain_Name:"Location ID DomainName",Location_ID:"Location ID",Location_Transaction_Code:"Location TransactionCode",Country_Code_3_ID:"Country Code 3 ID",AddressLine:"Address Line",AddressLineSequenceNumber:"Address Line Sequence Number"},transaction:{Gtm_Transaction_ID_Domain_Name:"Transaction ID DomainName",Gtm_Transaction_ID:"Transaction ID",Gtm_Transaction_Line_ID_Domain_Name:"Line ID DomainName",Gtm_Transaction_Line_ID:"Line ID"},bom:{},orderBase:{Source_Location_Domain_Name:"Source Location DomainName",Source_Location_ID:"Source Location ID",Destination_Location_Domain_Name:"Destination Location DomainName",Destination_Location_ID:"Destination Location ID",Order_Configuration:"Order Configuration",Line_Item_Domain_Name:"Line Item DomainName",Line_Item_ID:"Line Item ID",Early_Pickup_Dt:"EarlyPickup Date",Early_Pickup_TZID:"EarlyPickup TimeZone",Early_Pickup_TZOffset:"EarlyPickup TimeZoneOffset",Late_Pickup_Dt:"LatePickup Date",Late_Pickup_TZID:"LatePickup TimeZone",Late_Pickup_TZOffset:"LatePickup TimeZoneOffset",Early_Delivery_Dt:"EarlyDelivery Date",Early_Delivery_TZID:"EarlyDelivery TimeZone",Early_Delivery_TZOffset:"EarlyDelivery TimeZoneOffset",Late_Delivery_Dt:"LateDelivery Date",Late_Delivery_TZID:"LateDelivery TimeZone",Late_Delivery_TZOffset:"LateDelivery TimeZoneOffset",Order_Base_Line_Packaged_Item_Count:"Line PackagedItem Count"},trackingEvent:{Shipment_ID:"Shipment ID"},shipment:{Equipment_Group_ID_DomainName:"Equipment Group ID DomainName",Equipment_Group_ID:"Equipment Group ID",Equipment_ID_DomainName:"Equipment ID DomainName",Equipment_ID:"Equipment ID",StartDt:"Start Date",EndDt:"End Date",ArrivalTime:"Arrival Time"}};const _=async e=>{const t={data:"",error:""};try{const{data:n}=await e;t.data=n}catch(a){t.error=a.error}return t.data||t.error||(t.error="Something failed!"),t};exports.asyncHandler=_;const p=function(e){return i.default.sign({...e},exports.CONSTS.JWT_PRIVATE_KEY,{expiresIn:"12h"})};exports.generateAuthToken=p;const D=e=>`/GC3/glog.webserver.transmission.ITransactionDetailServlet/1556964221938?ct=NzU0OTQ3NTc2Nzg3NTk4MjE5Mw%3D%3D&id=${e}&is_new_window=true`;exports.getReportUrl=D;const u=()=>"/GC3/glog.webserver.finder.WindowOpenFramesetServlet/1563245261188?ct=MTc2NDM0MTg3ODk1NjM1MjU0MQ%3D%3D&bcKey=MTU2MzI0MzAwOTU2NDoy&url=GTM_OTM_OBJECTCustManagement%3Fmanager_layout_gid%3DGTM_OTM_MANAGER_LAYOUT_GID%26management_action%3Dview%26finder_set_gid%3DGTM_OTM_FINDER_SET%26pk%3DGTM_OTM_OBJECT_GID";exports.getViewUrl=u;const d=e=>[{name:"Item",link:"item",icon:"shopping_cart",api:"items",display:!0},{name:"Party",link:"party",icon:"business",api:"party",display:!0},{name:"Location",link:"location",icon:"add_location",api:"location",display:!0},{name:"Transaction",link:"transaction",icon:"swap_horizontal_circle",api:"transactions",display:!0},{name:"Order Base",link:"order-base",icon:"store",api:"order-base",display:!0},{name:"Order Release",link:"order-release",icon:"airport_shuttle",api:"order-release",display:!0},{name:"Bom",link:"bom",icon:"ballot",api:"bom",display:!0},{name:"Shipment",link:"shipment",icon:"directions_boat",api:"shipment",display:!0},{name:"Tracking Event",link:"tracking-event",icon:"gps_fixed",api:"tracking-event",display:!0},{name:"Audit",link:"admin/audit",icon:"history",api:"audit",display:e},{name:"Settings",link:"admin/settings",icon:"settings",api:"settings",display:e}];exports.getSidebar=d;const I=(e,t)=>{const a={newPath:e,newName:e},n=new RegExp(`${t}.`+"[0-9]."),i=e.match(n);return i?(a.newPath=e.replace(i[0],`${t}.INDEX.`),a.newName=e.replace(i[0],`${t}.`)):a.newPath=e.replace(`${t}.`,`${t}.INDEX.`),a.newPath.match(/\.[0-9]\./)?(a.newPath=T(a.newPath,/\.[0-9]\./,".INDEX."),a.newName=a.newPath.replace(/INDEX\./g,""),a):a};function g(){return e=>e.trim().replace(" ","-").toLowerCase()}function T(e,t,a){return e.replace(new RegExp(t,"g"),a)}exports.convertPath=I;const L=e=>(t,a,n)=>{Promise.resolve(e(t,a,n)).catch(n)};exports.asyncRouteHandler=L;const N=(e,t)=>e.split(".")[1]?{path:`${t}`,value:e.split(".")[0]}:{path:t,value:"PUBLIC"};exports.getDomainName=N;const E=(e,t)=>e.split(".")[1]?{path:`${t}`,value:e.split(".")[1]}:{path:`${t}`,value:e};exports.getXID=E;const y=(e,t,a)=>({path:`${t}`,value:a+1});exports.getSequence=y;const f=(e,t)=>({path:`${t}`,value:"IU"});exports.getTC=f;
},{}],"JZWk":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.decrypt=exports.encrypt=void 0;const t=require("./other"),r=e(require("simple-crypto-js")),o=t.CONSTS.JWT_PRIVATE_KEY,p=e=>{return new r.default(o).encrypt(e)};exports.encrypt=p;const s=e=>{return new r.default(o).decrypt(e)};exports.decrypt=s;
},{"./other":"irtd"}],"KJs0":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),t=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(r){if(r&&r.__esModule)return r;var o={};if(null!=r)for(var n in r)"default"!==n&&Object.prototype.hasOwnProperty.call(r,n)&&e(o,r,n);return t(o,r),o};Object.defineProperty(exports,"__esModule",{value:!0}),exports.dbXml=exports.wmServlet=void 0;const o=r(require("curlrequest")),n=(e,t,r,n)=>{const i={url:e+"/GC3/glog.integration.servlet.WMServlet",retries:30,data:t,headers:{"content-type":"text/xml",Authorization:"Basic "+Buffer.from(r+":"+n).toString("base64")}};return new Promise((e,t)=>{const r={data:"",error:""};o.request(i,function(o,n){o?(r.error=o,t(r)):(r.data=n,e(r))})})};exports.wmServlet=n;const i=(e,t,r,n)=>{const i={url:e+"/GC3/glog.integration.servlet.DBXMLServlet?command=xmlExport",retries:30,data:t,headers:{"content-type":"text/xml",Authorization:"Basic "+Buffer.from(r+":"+n).toString("base64")}};return new Promise((e,t)=>{const r={data:"",error:""};o.request(i,function(o,n){o?(r.error=o,t(r)):(r.data=n,e(r))})})};exports.dbXml=i;
},{}],"ijEX":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.authDengineUser=void 0;const R=require("../api/gtm"),e=async({url:e,username:_,password:E})=>{const L=`<sql2xml><Query><RootName>GL_USER_ACR_ROLE</RootName><Statement>${`SELECT NVL((SELECT NVL((SELECT (select ACR_ROLE_GID from GL_USER_ACR_ROLE  WHERE GL_USER_GID = '${_}' AND ACR_ROLE_GID LIKE '%GTM - DATA_UPLOAD_ADMIN' AND ROWNUM=1) GTM_CURRENT_USER_ACL FROM DUAL),(SELECT (select ACR_ROLE_GID from GL_USER_ACR_ROLE  WHERE GL_USER_GID = '${_}' AND ACR_ROLE_GID LIKE '%GTM - DATA_UPLOAD_USER' AND ROWNUM=1)  FROM DUAL))  FROM DUAL ),'NOT_AUTHORISED') GTM_CURRENT_USER_ACL FROM DUAL`}</Statement></Query></sql2xml>`;return(0,R.dbXml)(e,L,_,E)};exports.authDengineUser=e;
},{"../api/gtm":"KJs0"}],"hXw8":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const r=e(require("joi")),t=require("./../helper/other"),s=require("./../helper/encrypt"),n=e(require("express")),a=require("../helper/gtmAuth"),u=n.default.Router();function i(e){const t={username:r.default.string().min(1).max(30).required(),password:r.default.string().min(1).max(255).required()};return r.default.validate(e,t)}u.post("/",(0,t.asyncRouteHandler)(async(e,r)=>{const{error:n}=i(e.body);if(n)return r.status(400).send(n.details[0].message);let{username:u,password:d,instance:c}=e.body;c||(c=t.CONSTS.CURRENT_INSTANCE);const l={username:u,password:d,url:o(c)},{data:S,error:m}=await(0,t.asyncHandler)((0,a.authDengineUser)(l));if(S.includes("Unauthorized"))return r.status(403).send("Sorry, you don't have access!");if(m)return r.status(500).send(m);if(S.toString().includes("error"))return r.status(500).send(S.match("<error>(.*)</error>")[1]);const p=S.match('GTM - DATA_UPLOAD_(.*)"')[1].trim();if("ADMIN"!==p&&"USER"!==p)return r.status(403).send("Sorry, you don't have access!");const N="ADMIN"===p,f=(0,s.encrypt)(d),T=(0,t.getSidebar)(N).filter(e=>t.CONSTS.SUBSCIPTION.includes(e.name.trim().toLowerCase().replace(" ","-"))),h=u.split(".")[0],y=(0,t.generateAuthToken)({username:u,domain:h,isAdmin:N,crypto:f,instance:c,sidebar:T});return r.send({data:y})}));const o=e=>"dev"===e?t.CONSTS.DEV_INSTANCEURL:"test"===e?t.CONSTS.TEST_INSTANCEURL:"prod"===e?t.CONSTS.PROD_INSTANCEURL:void 0;exports.default=u;
},{"./../helper/other":"irtd","./../helper/encrypt":"JZWk","../helper/gtmAuth":"ijEX"}],"MNoc":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("jsonwebtoken")),r=require("../helper/other"),s=require("../helper/encrypt");async function n(e,n,u){const c=e.header("x-auth-token");if(!c)return n.status(401).send("Access denied. No token provided.");const d=e.baseUrl.split("/");if(!r.CONSTS.SUBSCIPTION.includes(d[d.length-1]))return n.status(401).send("Sorry, you don't have access.");try{const d=t.default.verify(c,r.CONSTS.JWT_PRIVATE_KEY);e.user=d,e.user.url=o(d),e.user.crypto&&(e.user.password=(0,s.decrypt)(d.crypto).toString()),u()}catch(i){n.status(400).send("Invalid token.")}}exports.default=n;const o=e=>{const{instance:t}=e;return"test"===t?r.CONSTS.TEST_INSTANCEURL:"prod"===t?r.CONSTS.PROD_INSTANCEURL:r.CONSTS.DEV_INSTANCEURL};
},{"../helper/other":"irtd","../helper/encrypt":"JZWk"}],"zMRv":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const r=e(require("../middleware/auth")),t=e(require("express")),s=require("../helper/other"),a=t.default.Router();a.get("/me",[r.default],(0,s.asyncRouteHandler)(async(e,r)=>{const{username:t,isAdmin:s,instance:a,sidebar:u}=e.user,i=t.split(".")[0];return r.send({data:{username:t,domain:i,isAdmin:s,instance:a,sidebar:u}})})),exports.default=a;
},{"../middleware/auth":"MNoc","../helper/other":"irtd"}],"bJb7":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getTransmissionStatus=exports.getShipmentPropsfromGtm=exports.getTrackingEventPropfromOtm=exports.getOrderBasePropsfromGtm=exports.getPartyPropfromGtm=exports.getTransactionPropsfromGtm=exports.getBomPropsfromGtm=exports.getLocationPropfromOtm=exports.getReleasePropsfromGtm=exports.getItemPropfromGtm=void 0,exports.getItemPropfromGtm="<sql2xml><Query><RootName>GTM</RootName><Statement>\nselect(select listagg(REMARK_QUAL_GID, ',') within group (order by REMARK_QUAL_GID) from (select REMARK_QUAL_GID, sum(length(REMARK_QUAL_GID) + 2) over (order by REMARK_QUAL_GID) running_length from REMARK_QUAL) where running_length &lt; 4000) REMARKS, (SELECT listagg(ITEM_REFNUM_QUAL_GID,',') within group (order by ITEM_REFNUM_QUAL_GID) FROM ITEM_REFNUM_QUAL) REFNUMS, (SELECT listagg(ITEM_FEATURE_QUAL_GID,',') within group (order by ITEM_FEATURE_QUAL_GID) FROM ITEM_FEATURE_QUAL) ITEMFEATURES, (SELECT listagg(GTM_PROD_CLASS_TYPE_GID,',') within group (order by GTM_PROD_CLASS_TYPE_GID) FROM GTM_PROD_CLASS_TYPE) GTMITEMCLASSIFICATIONS, (SELECT listagg(GTM_LANGUAGE_GID ||'::'|| LANGUAGE_NAME,',') within group (order by GTM_LANGUAGE_GID ||'::'|| LANGUAGE_NAME) FROM GTM_LANGUAGE ) GTMITEMDESCRIPTIONS from dual\n</Statement></Query></sql2xml>",exports.getReleasePropsfromGtm="<sql2xml><Query><RootName>GTM</RootName><Statement>\nselect(select listagg(REMARK_QUAL_GID, ',') within group (order by REMARK_QUAL_GID) from (select REMARK_QUAL_GID, sum(length(REMARK_QUAL_GID) + 2) over (order by REMARK_QUAL_GID) running_length from REMARK_QUAL) where running_length &lt; 4000) REMARKS, (SELECT listagg(ORDER_RELEASE_REFNUM_QUAL_GID,',') within group (order by ORDER_RELEASE_REFNUM_QUAL_GID) FROM ORDER_RELEASE_REFNUM_QUAL) RELEASE_REFNUMS, (SELECT listagg(OR_LINE_REFNUM_QUAL_GID,',') within group (order by OR_LINE_REFNUM_QUAL_GID) FROM ORDER_RELEASE_LINE_REFNUM_QUAL) RELEASE_lINE_REFNUMS, (SELECT listagg(INVOLVED_PARTY_QUAL_GID,',') within group (order by INVOLVED_PARTY_QUAL_GID) FROM INVOLVED_PARTY_QUAL) INVOLVED_PARTY, (SELECT listagg(ITEM_FEATURE_QUAL_GID,',') within group (order by ITEM_FEATURE_QUAL_GID) FROM ITEM_FEATURE_QUAL) lINE_ITEM_ATTRIBUTE from dual\n</Statement></Query></sql2xml>",exports.getLocationPropfromOtm="<sql2xml><Query><RootName>GTM</RootName><Statement>\nselect(select listagg(REMARK_QUAL_GID, ',') within group (order by REMARK_QUAL_GID) from (select REMARK_QUAL_GID, sum(length(REMARK_QUAL_GID) + 2) over (order by REMARK_QUAL_GID) running_length from REMARK_QUAL) where running_length &lt; 4000) REMARKS, (SELECT listagg(LOCATION_REFNUM_QUAL_GID,',') within group (order by LOCATION_REFNUM_QUAL_GID) FROM LOCATION_REFNUM_QUAL) REFNUMS from dual\n</Statement></Query></sql2xml>",exports.getBomPropsfromGtm="<sql2xml><Query><RootName>GTM</RootName><Statement>\nselect(select listagg(REMARK_QUAL_GID, ',') within group (order by REMARK_QUAL_GID) from (select REMARK_QUAL_GID, sum(length(REMARK_QUAL_GID) + 2) over (order by REMARK_QUAL_GID) running_length from REMARK_QUAL) where running_length &lt; 4000) REMARKS, (SELECT listagg(GTM_STRUCTURE_REFNUM_QUAL_GID,',') within group (order by GTM_STRUCTURE_REFNUM_QUAL_GID) FROM GTM_STRUCTURE_REFNUM_QUAL) REFNUMS, (SELECT listagg(GTM_STR_COMP_REFNUM_QUAL_GID,',') within group (order by GTM_STR_COMP_REFNUM_QUAL_GID) FROM GTM_STR_COMPONENT_REFNUM_QUAL) COMPONENT_REFNUMS, (SELECT listagg(INVOLVED_PARTY_QUAL_GID,',') within group (order by INVOLVED_PARTY_QUAL_GID) FROM INVOLVED_PARTY_QUAL) INVOLVED_PARTY from dual\n</Statement></Query></sql2xml>",exports.getTransactionPropsfromGtm="<sql2xml><Query><RootName>GTM</RootName><Statement>\nselect(select listagg(REMARK_QUAL_GID, ',') within group (order by REMARK_QUAL_GID) from (select REMARK_QUAL_GID, sum(length(REMARK_QUAL_GID) + 2) over (order by REMARK_QUAL_GID) running_length from REMARK_QUAL) where running_length &lt; 4000) REMARKS, (select listagg(DATE_QUALIFIER_GID, ',') within group (order by DATE_QUALIFIER_GID) from (select DATE_QUALIFIER_GID, sum(length(DATE_QUALIFIER_GID) + 2) over (order by DATE_QUALIFIER_GID) running_length from GTM_DATE_QUALIFIER) where running_length &lt; 4000) DATES, (select listagg(GTM_QUANTITY_TYPE_GID ||'['||TYPE||']' , ',') within group (order by GTM_QUANTITY_TYPE_GID) from GTM_QUANTITY_TYPE) QUANTITY,(select listagg(GTM_VALUE_QUALIFIER_GID, ',') within group (order by GTM_VALUE_QUALIFIER_GID) from (select GTM_VALUE_QUALIFIER_GID, sum(length(GTM_VALUE_QUALIFIER_GID) + 2) over (order by GTM_VALUE_QUALIFIER_GID) running_length from GTM_VALUE_QUALIFIER) where running_length &lt; 4000) CURRENCY,(SELECT listagg(GTM_TRANS_REFNUM_QUAL_GID,',') within group (order by GTM_TRANS_REFNUM_QUAL_GID) FROM GTM_TRANS_REFNUM_QUAL) GTMTRANS_REFNUMS, (SELECT listagg(GTM_TRANSLINE_REFNUM_QUAL_GID,',') within group (order by GTM_TRANSLINE_REFNUM_QUAL_GID) FROM GTM_TRANSLINE_REFNUM_QUAL) GTMTRANSACTION_lINE_REFNUMS, (SELECT listagg(INVOLVED_PARTY_QUAL_GID,',') within group (order by INVOLVED_PARTY_QUAL_GID) FROM INVOLVED_PARTY_QUAL) INVOLVED_PARTY,(SELECT listagg(CURRENCY_GID,',') within group (order by CURRENCY_GID) FROM CURRENCY) CURRENCY_UOM,(SELECT listagg(UOM_CODE||'['||TYPE||']',',') within group (order by UOM_CODE) FROM UOM where UOM_CODE in (select distinct UOM_CODE from GTM_TRANSACTION_QUANTITY)) QUANTITY_UOM from dual\n</Statement></Query></sql2xml>",exports.getPartyPropfromGtm="<sql2xml><Query><RootName>GTM</RootName><Statement>\nselect(select listagg(REMARK_QUAL_GID, ',') within group (order by REMARK_QUAL_GID) from (select REMARK_QUAL_GID, sum(length(REMARK_QUAL_GID) + 2) over (order by REMARK_QUAL_GID) running_length from REMARK_QUAL) where running_length &lt; 4000) REMARKS, (SELECT listagg(GTM_PARTY_REFNUM_QUAL_GID,',') within group (order by GTM_PARTY_REFNUM_QUAL_GID) FROM GTM_PARTY_REFNUM_QUAL) CONTACT_REFNUMS from dual\n</Statement></Query></sql2xml>",exports.getOrderBasePropsfromGtm="<sql2xml><Query><RootName>GTM</RootName><Statement>\nselect(select listagg(REMARK_QUAL_GID, ',') within group (order by REMARK_QUAL_GID) from (select REMARK_QUAL_GID, sum(length(REMARK_QUAL_GID) + 2) over (order by REMARK_QUAL_GID) running_length from REMARK_QUAL) where running_length &lt; 4000) REMARKS, (SELECT listagg(OB_REFNUM_QUAL_GID,',') within group (order by OB_REFNUM_QUAL_GID) FROM OB_REFNUM_QUAL) ORDER_BASE_REFNUMS, (SELECT listagg(OB_LINE_REFNUM_QUAL_GID,',') within group (order by OB_LINE_REFNUM_QUAL_GID) FROM OB_LINE_REFNUM_QUAL) OB_LINE_REFNUMS, (SELECT listagg(INVOLVED_PARTY_QUAL_GID,',') within group (order by INVOLVED_PARTY_QUAL_GID) FROM INVOLVED_PARTY_QUAL) INVOLVED_PARTY, (SELECT listagg(ITEM_FEATURE_QUAL_GID,',') within group (order by ITEM_FEATURE_QUAL_GID) FROM ITEM_FEATURE_QUAL) lINE_ITEM_ATTRIBUTE from dual\n</Statement></Query></sql2xml>",exports.getTrackingEventPropfromOtm="<sql2xml><Query><RootName>GTM</RootName><Statement>\nselect(SELECT listagg(SHIPMENT_REFNUM_QUAL_GID,',') within group (order by SHIPMENT_REFNUM_QUAL_GID) FROM SHIPMENT_REFNUM_QUAL) REFNUMS from dual\n</Statement></Query></sql2xml>",exports.getShipmentPropsfromGtm="<sql2xml><Query><RootName>GTM</RootName><Statement>\nselect(select listagg(REMARK_QUAL_GID, ',') within group (order by REMARK_QUAL_GID) from (select REMARK_QUAL_GID, sum(length(REMARK_QUAL_GID) + 2) over (order by REMARK_QUAL_GID) running_length from REMARK_QUAL) where running_length &lt; 4000) REMARKS, (SELECT listagg(SHIPMENT_REFNUM_QUAL_GID,',') within group (order by SHIPMENT_REFNUM_QUAL_GID) FROM SHIPMENT_REFNUM_QUAL) SHIPMENT_REFNUMS from dual\n</Statement></Query></sql2xml>";const _=(_,e)=>`<sql2xml>\n    <Query>\n      <RootName>\n      TRANSACTION_STATUS\n      </RootName>\n      <Statement>\n        select OBJECT_GID\n          ,DATA_QUERY_TYPE_GID\n          ,I_TRANSACTION_NO\n          ,STATUS\n        from i_transaction\n        where ${e?"I_TRANSACTION_NO":"I_TRANSMISSION_NO"}\n          in ( ${_.join(",")} )\n      </Statement>\n    </Query>\n  </sql2xml>`;exports.getTransmissionStatus=_;
},{}],"C6I7":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Report=void 0;const t=e(require("mongoose")),r=new t.default.Schema({item:{type:"Number",default:0},party:{type:"Number",default:0},location:{type:"Number",default:0},"order-release":{type:"Number",default:0},"order-base":{type:"Number",default:0},bom:{type:"Number",default:0},transaction:{type:"Number",default:0},"tracking-event":{type:"Number",default:0},shipment:{type:"Number",default:0},user:{type:"String",required:!0},insertDate:{type:Date,default:Date.now}}),u=e=>t.default.model("Report",r,`Report_${e}`);exports.Report=u;
},{}],"IMRL":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.validate=exports.Setting=void 0;const t=e(require("joi")),r=e(require("mongoose")),u=new r.default.Schema({url:{type:"String"},version:{type:"Number"},glogPerTrx:{type:"Number",default:10},item:{type:"Number",default:0},party:{type:"Number",default:0},location:{type:"Number",default:0},"order-release":{type:"Number",default:0},"order-base":{type:"Number",default:0},bom:{type:"Number",default:0},transaction:{type:"Number",default:0},"tracking-event":{type:"Number",default:0},shipment:{type:"Number",default:0}});function a(e){const r={glogPerTrx:{type:Number,required:!0}};return t.default.validate(e,r)}const o=e=>r.default.model("Setting",u,`Setting_${e}`);exports.Setting=o,exports.validate=a;
},{}],"oAdS":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("express")),s=e(require("multiparty")),r=e(require("node-xlsx")),a=require("../helper/other"),n=require("../api/gtm"),i=require("../helper/dbXmlQuery"),o=require("../api/gtm"),u=e(require("./../middleware/auth")),d=require("../models/report"),l=require("../models/setting"),c=t.default.Router();c.post("/",[u.default],(0,a.asyncRouteHandler)(async(e,t)=>{const{username:s,password:r,url:i}=e.user,{xml:o,xmlNs:u}=e.body;let d=o.toString();d=d.replace("<Transmission>",`<Transmission xmlns="${u[0]}" xmlns:otm="${u[0]}" xmlns:gtm="${u[1]}" >`);const{data:l,error:c}=await(0,a.asyncHandler)((0,n.wmServlet)(i,d,s,r));if(c)return t.status(400).send(c);if(!l.includes("ReferenceTransmissionNo"))return t.status(400).send("Invalid csv Data");const m=l.match(/ReferenceTransmissionNo>(.*?)</)[1];return t.send({data:{ReferenceTransmissionNo:m}})})),c.post("/filedata",[u.default],(0,a.asyncRouteHandler)(async(e,t)=>{(new s.default.Form).parse(e,async function(e,s,a){const n=a[Object.keys(a)[0]][0].path,i=await r.default.parse(n,{raw:!0});return t.status(200).send({data:i[0].data})})})),c.post("/status",[u.default],(0,a.asyncRouteHandler)(async(e,t)=>{const{username:s,password:r,url:n}=e.user,{transmission:u,reProcess:c,xids:m,considerXid:p}=e.body;if(!u.length)return t.status(400).send("Bad request!");const T=(0,i.getTransmissionStatus)(u,c),{data:f,error:N}=await(0,a.asyncHandler)((0,o.dbXml)(n,T,s,r));if(N)return t.status(400).send(N);const S=f.match(/TRANSACTION_STATUS(.*?)>/g),R=[];let h="";for(let i=0;i<S.length;i++){const e=S[i];h=e.match(/DATA_QUERY_TYPE_GID="(.*?)"/)[1].toLowerCase().replace("gtm","").replace("contact","party").trim().replace(" ","-");const t=e.match(/I_TRANSACTION_NO="(.*?)"/)[1],s=e.match(/OBJECT_GID="(.*?)"/)[1],r=e.match(/STATUS="(.*?)"/)[1];R.push({xid:p?m[i]:s.includes(".")?s.split(".")[1]:s,transmission:t,status:r,instanceURL:n+(0,a.getReportUrl)(t),viewURL:n+(0,a.getViewUrl)()})}if(!c){const e=Array.from(new Set(m)),t={$inc:{[h]:e.length}};await(0,l.Setting)(a.CONSTS.CURRENT_INSTANCE).findOneAndUpdate({version:+a.CONSTS.GTMVERSION},t,{new:!0}),await(0,d.Report)(a.CONSTS.CURRENT_INSTANCE).create({instance:a.CONSTS.CURRENT_INSTANCE,user:s,[h]:e.length})}return t.send({data:R})})),exports.default=c;
},{"../helper/other":"irtd","../api/gtm":"KJs0","../helper/dbXmlQuery":"bJb7","./../middleware/auth":"MNoc","../models/report":"C6I7","../models/setting":"IMRL"}],"Yp05":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Release=void 0;const t=e(require("mongoose")),a=new t.default.Schema({name:String,required:Boolean,disabled:Boolean,display:Boolean,isMandatory:Boolean,type:String,displayText:String,defaultValue:String,gtmVersion:Number,xmlNs:["String"],path:["Mixed"]}),o=(e,o)=>t.default.model("Release",a,`${e}_Release_${o}`);exports.Release=o;
},{}],"Ys6U":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SchemaRelease=void 0;const t=e(require("mongoose")),s=new t.default.Schema({xmlNs:{type:["String"]},gtmVersion:{type:"Number"},Release:{type:"Mixed"}});exports.SchemaRelease=t.default.model("SchemaRelease",s,"OrderReleaseSchema");
},{}],"jN2X":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getDefaultValue=exports.getMandatoryElement=exports.getElementName=void 0;const e=require("./other"),a=e=>{const a=e.replace(/(otm:|otm|gtm:|gtm)/gi,""),t=a.lastIndexOf("Gid"),r=a.substring(0,t-1).lastIndexOf(".")+1,o=a.substring(r,t-1),s=a.substring(a.lastIndexOf(".")+1),c=a.lastIndexOf("TransactionCode"),m=a.substring(0,c-1).lastIndexOf(".")+1,d=a.lastIndexOf("GtmItemCountryOfOrigin"),l=a.substring(0,d-1).lastIndexOf(".")+1,D=a.lastIndexOf("SequenceNumber"),L=a.substring(0,D-1).lastIndexOf(".")+1,h=a.lastIndexOf("Description"),u=a.substring(0,h-1).lastIndexOf(".")+1;let _=a.search("Xid")>-1?o:s;switch(_=_.replace(/(otm:|otm|gtm:|gtm)/gi,"").trim(),!0){case"DomainName"===_:_=a.substring(r,t-1)+_;break;case"TransactionCode"===_:_=a.substring(m,c-1).replace(/Header/g,"")+_;break;case"GtmItemCountryOfOrigin"===_:_="Suppliers"+a.substring(l,d-1)+_;break;case"SequenceNumber"===_:_=a.substring(L,D-1)+_;break;case"Description"===_:_=a.substring(u,h-1)+_;break;default:_=_.trim()}const p=(_=_.replace(/(otm:|otm|gtm:|gtm)/gi,"").trim()).match(/[A-Z][a-z]+|[0-9]+/g);return _=n(_=p&&p.length>1?p.join(" ").replace("Gid","ID"):_),i(_,e)};exports.getElementName=a;const t=(e,a=[])=>a.findIndex(a=>a===e)>-1;exports.getMandatoryElement=t;const r=(e,a)=>e.search("TransactionCode")>-1?"IU":e.search("DomainName")>-1?a:"";exports.getDefaultValue=r;const i=(a,t)=>t.match(/GtmStructureComponent/)?`Bom Component ${a.replace(/(GtmStructure(.*?)Component)/gi,"").trim()}`:t.match(/GtmStructure(.*?)/)?a.replace(/(Structure)/g,"Bom").trim():t.match(/GtmContact(.*?)AddressLines(.*?)SequenceNumber/)?e.NAME.party.AddressLineSequenceNumber:t.match(/GtmContact(.*?)AddressLines(.*?)AddressLine/)?e.NAME.party.AddressLine:t.match(/Location(.*?)AddressLines(.*?)SequenceNumber/)?e.NAME.location.AddressLineSequenceNumber:t.match(/Location(.*?)AddressLines(.*?)AddressLine/)?e.NAME.location.AddressLine:t.match(/Release(.*?)ShipFromLocationRef(.*?)DomainName/)?e.NAME.release.Source_Location_Domain_Name:t.match(/Release(.*?)ShipFromLocationRef(.*?)Xid/)?e.NAME.release.Source_Location_ID:t.match(/Release(.*?)ShipToLocationRef(.*?)DomainName/)?e.NAME.release.Destination_Location_Domain_Name:t.match(/Release(.*?)ShipFromLocationRef(.*?)Xid/)?e.NAME.release.Source_Location_ID:t.match(/Release(.*?)ShipToLocationRef(.*?)Xid/)?e.NAME.release.Destination_Location_ID:t.match(/Release(.*?)ReleaseMethodGid(.*?)Xid/)?e.NAME.release.Order_Configuration:t.match(/Release(.*?)InitialItemGid(.*?)DomainName/)?e.NAME.release.Line_Item_Domain_Name:t.match(/Release(.*?)InitialItemGid(.*?)Xid/)?e.NAME.release.Line_Item_ID:t.match(/Release(.*?)ReleaseLine/)?`Line ${a.replace(/Release(.*?)Line/,"").trim()}`:t.match(/EarlyPickupDt(.*?)GLogDate/)?e.NAME.orderBase.Early_Pickup_Dt:t.match(/EarlyPickupDt(.*?)TZId/)?e.NAME.orderBase.Early_Pickup_TZID:t.match(/EarlyPickupDt(.*?)TZOffset/)?e.NAME.orderBase.Early_Pickup_TZOffset:t.match(/LatePickupDt(.*?)GLogDate/)?e.NAME.orderBase.Late_Pickup_Dt:t.match(/LatePickupDt(.*?)TZId/)?e.NAME.orderBase.Late_Pickup_TZID:t.match(/LatePickupDt(.*?)TZOffset/)?e.NAME.orderBase.Late_Pickup_TZOffset:t.match(/LateDeliveryDt(.*?)GLogDate/)?e.NAME.orderBase.Late_Delivery_Dt:t.match(/LateDeliveryDt(.*?)TZId/)?e.NAME.orderBase.Late_Delivery_TZID:t.match(/LateDeliveryDt(.*?)TZOffset/)?e.NAME.orderBase.Late_Delivery_TZOffset:t.match(/EarlyDeliveryDt(.*?)GLogDate/)?e.NAME.orderBase.Early_Delivery_Dt:t.match(/EarlyDeliveryDt(.*?)TZId/)?e.NAME.orderBase.Early_Delivery_TZID:t.match(/EarlyDeliveryDt(.*?)TZOffset/)?e.NAME.orderBase.Early_Delivery_TZOffset:t.match(/StartDt(.*?)GLogDate/)?e.NAME.shipment.StartDt:t.match(/EndDt(.*?)GLogDate/)?e.NAME.shipment.EndDt:t.match(/ArrivalTime(.*?)GLogDate/)?e.NAME.shipment.ArrivalTime:t.match(/TransOrder(.*?)ShipFromLocationRef(.*?)DomainName/)?e.NAME.orderBase.Source_Location_Domain_Name:t.match(/TransOrder(.*?)ShipFromLocationRef(.*?)Xid/)?e.NAME.orderBase.Source_Location_ID:t.match(/TransOrder(.*?)ShipToLocationRef(.*?)DomainName/)?e.NAME.orderBase.Destination_Location_Domain_Name:t.match(/TransOrder(.*?)ShipFromLocationRef(.*?)Xid/)?e.NAME.orderBase.Source_Location_ID:t.match(/TransOrder(.*?)ShipToLocationRef(.*?)Xid/)?e.NAME.orderBase.Destination_Location_ID:t.match(/TransOrder(.*?)ReleaseMethodGid(.*?)Xid/)?e.NAME.orderBase.Order_Configuration:t.match(/TransOrder(.*?)InitialItemGid(.*?)DomainName/)?e.NAME.orderBase.Line_Item_Domain_Name:t.match(/TransOrder(.*?)InitialItemGid(.*?)Xid/)?e.NAME.orderBase.Line_Item_ID:t.match(/TransOrderLine/)?`Line ${a.replace(/(Trans(.*?)Order(.*?)Line|Order(.*?)Line)/g,"").trim()}`:t.match(/TransOrder(.*?)TransOrderHeader/)?a.replace(/Trans(.*?)Order/g,"OrderBase").trim():t.match(/GtmTransactionLine/)?`Line ${a.replace(/(Transaction(.*?)Line)/gi,"").trim()}`:t.match(/GtmTransaction(.*?)/)?a.replace(/(Transaction)/g,"Transaction").trim():t.match(/LocationRefGid(.*?)DomainName/)?e.NAME.location.Location_ID_Domain_Name:t.match(/LocationRefGid(.*?)Xid/)?e.NAME.location.Location_ID:t.match(/LocationRefGid\.(.*?)/)&&!a.includes("LocationRef")?`Location ${a.trim()}`:t.match(/Contact(.*?)/)?a.replace(/(Party|Contact)/gi,"Party").trim():a;function n(e){return e.replace("Transaction Code","TransactionCode").replace("Domain Name","DomainName").replace("Service Provider","ServiceProvider").replace("User Defined","UserDefined").replace("Ship Unit","ShipUnit").replace("Packaged Item","PackagedItem")}
},{"./other":"irtd"}],"iG5u":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mapItemDescription=exports.mapInvolvedParty=exports.mapItemClassification=exports.mapItemFeature=exports.mapRemark=exports.mapRefnum=exports.mapHeader=void 0;const e=require("../other"),t=require("../renamer"),a=require("../other"),i=["Release ID DomainName","Release ID","Release TransactionCode","Line ID DomainName","Line ID","Line TransactionCode",...Object.values(a.NAME.release)],p=(t,a,i)=>{const p=(0,e.capitalize)(i.split("_").join(" "));return p.split(".")[1]?p.split(".")[1]:p},r=(e,t)=>{return e.findIndex(e=>e.path.search(t)>-1)};for(let c=0;c<e.getSequence.length;c++){e.getSequence[c]}const n=(e,a,p,r,n)=>({name:e.name,required:!0,disabled:(0,t.getMandatoryElement)(e.name,i),display:(0,t.getMandatoryElement)(e.name,i),isMandatory:(0,t.getMandatoryElement)(e.name,i),type:a,displayText:e.name,defaultValue:(0,t.getDefaultValue)(e.path,n),path:[e.path],gtmVersion:p,xmlNs:r});exports.mapHeader=n;const s=(a,i,n,s,l,o,m,d)=>{const u=r(i,"Xid"),c=r(i,"DomainName"),h=r(i,"RefnumValue"),D=r(i,"TransactionCode");return{name:`${m} ${a}`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${m} ${p(0,0,a)}`.trim(),defaultValue:(0,t.getDefaultValue)(i[h].path,d),path:[{path:i[h].path.replace("INDEX",o),value:""},(0,e.getDomainName)(a,i[c].path.replace("INDEX",o)),(0,e.getTC)(a,i[D].path.replace("INDEX",o)),(0,e.getXID)(a,i[u].path.replace("INDEX",o))],gtmVersion:s,xmlNs:l}};exports.mapRefnum=s;const l=(a,i,n,s,l,o,m,d)=>{const u=r(i,"Xid"),c=r(i,"DomainName"),h=r(i,"RemarkText"),D=r(i,"RemarkSequence"),g=r(i,"TransactionCode");return{name:`${m} ${a}`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${m} ${p(0,0,a)}`.trim(),defaultValue:(0,t.getDefaultValue)(i[h].path,d),path:[{path:i[h].path.replace("INDEX",o),value:""},(0,e.getTC)(a,i[g].path.replace("INDEX",o)),(0,e.getSequence)(a,i[D].path.replace("INDEX",o),o),(0,e.getDomainName)(a,i[c].path.replace("INDEX",o)),(0,e.getXID)(a,i[u].path.replace("INDEX",o))],gtmVersion:s,xmlNs:l}};exports.mapRemark=l;const o=(a,i,n,s,l,o,m,d)=>{const u=r(i,"Xid"),c=r(i,"DomainName"),h=r(i,"ItemFeatureValue"),D=r(i,"TransactionCode");return{name:`${m} ${a}`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${m} ${p(0,0,a)}`.trim(),defaultValue:(0,t.getDefaultValue)(i[h].path,d),path:[{path:i[h].path,value:""},(0,e.getDomainName)(a,i[c].path),(0,e.getTC)(a,i[D].path),(0,e.getXID)(a,i[u].path)],gtmVersion:s,xmlNs:l}};exports.mapItemFeature=o;const m=(a,i,p,n,s,l,o)=>{const m=r(i,"Xid"),d=r(i,"ClassificationCode"),u=r(i,"TransactionCode");return{name:`${a} Classification`,required:!0,disabled:!1,display:!1,type:p,displayText:`${a} Classification`,defaultValue:(0,t.getDefaultValue)(i[d].path,o),path:[{path:i[d].path,value:""},(0,e.getTC)(a,i[u].path),(0,e.getXID)(a,i[m].path)],gtmVersion:n,xmlNs:s}};exports.mapItemClassification=m;const d=(a,i,n,s,l,o,m,d="")=>{const u=r(i,/InvolvedPartyQualifierGid(.*?)Xid/),c=r(i,/ContactGid(.*?)Xid/),h=r(i,/ContactGid(.*?)DomainName/),D=r(i,"TransactionCode");return{name:`${m} ${a} Contact ID`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${m} ${p(0,0,a)} Contact ID`.trim(),defaultValue:(0,t.getDefaultValue)(i[c].path,d),path:[{path:i[c].path,value:""},(0,e.getTC)(a,i[D].path),{path:i[h].path,value:d},(0,e.getXID)(a,i[u].path)],gtmVersion:s,xmlNs:l}};exports.mapInvolvedParty=d;const u=(a,i,p,n,s,l,o)=>{const m=r(i,"Xid"),d=r(i,"DomainName"),u=r(i,":Description"),c=r(i,"SequenceNumber"),h=r(i,"TransactionCode");return{name:`Description in ${a.split("::")[1]}`,required:!0,disabled:!1,display:!1,type:p,displayText:`Description in ${a.split("::")[1]}`,defaultValue:(0,t.getDefaultValue)(i[u].path,o),path:[{path:i[u].path,value:""},(0,e.getTC)(a.split("::")[0],i[h].path),(0,e.getSequence)(a.split("::")[0],i[c].path,l),(0,e.getDomainName)(a.split("::")[0],i[d].path),(0,e.getXID)(a.split("::")[0],i[m].path)],gtmVersion:n,xmlNs:s}};exports.mapItemDescription=u;
},{"../other":"irtd","../renamer":"jN2X"}],"NFyl":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getUpdatedProp=exports.getReleaseData=exports.getReleaseSchema=void 0;const a=e(require("lodash")),t=e(require("promise-memoize")),n=require("../../models/release"),r=require("../../models/schemaRelease"),s=require("./releaseProps");function m(e,t,n,r){return new Promise(function(m){let{Header:l,Remark:i,Refnum:o,InvolvedParty:d}=e.Release.Release,{Header:R,Remark:p,Refnum:u,InvolvedParty:f}=e.Release.ReleaseLine;const c=e.xmlNs;l=l.map(e=>(0,s.mapHeader)(e,"Release : Header",t,c,r)),R=R.map(e=>(0,s.mapHeader)(e,"Release Line : Header",t,c,r));const h=n.match(/REMARKS="(.*?)"/)[1].split(",");i=h.map((e,a)=>(0,s.mapRemark)(e,i,"Release : Remark",t,c,a,"",r)),p=h.map((e,a)=>(0,s.mapRemark)(e,p,"Release Line : Remark",t,c,a,"Line",r));const v=n.match(/INVOLVED_PARTY="(.*?)"/)[1].split(",");d=v.map((e,a)=>(0,s.mapInvolvedParty)(e,d,"Release : Involved Party",t,c,a,"",r)),f=v.map((e,a)=>(0,s.mapInvolvedParty)(e,f,"Release Line : Involved Party",t,c,a,"Line",r));const P=n.match(/RELEASE_REFNUMS="(.*?)"/)[1].split(",");o=P.map((e,a)=>(0,s.mapRefnum)(e,o,"Release : Refnum",t,c,a,"",r));const _=n.match(/RELEASE_LINE_REFNUMS="(.*?)"/)[1].split(",");u=_.map((e,a)=>(0,s.mapRefnum)(e,u,"Release Line : Refnum",t,c,a,"Line",r)),m(a.default.uniqBy([...l,...i,...o,...d,...R,...p,...u,...f],e=>e.name))})}function l(e,t,r,s){return new Promise(async function(m){const l=a.default.differenceWith(e,t,(e,a)=>e.name===a.name),i=a.default.differenceWith(t,e,(e,a)=>e.name===a.name);if(l.length>0){const e=await(0,n.Release)(s,r).insertMany(l);m([...t,...e])}else i.length>0?(await(0,n.Release)(s,r).deleteMany({_id:{$in:[...i.map(e=>e._id)]}}),m(a.default.differenceWith(t,i,(e,a)=>e.name===a.name))):m(t)})}function i(e){return r.SchemaRelease.findOne({gtmVersion:e}).sort({_id:1})}exports.getReleaseSchema=(0,t.default)(i,{maxAge:6e4}),exports.getReleaseData=(0,t.default)(m,{maxAge:6e4}),exports.getUpdatedProp=(0,t.default)(l,{maxAge:6e4});
},{"../../models/release":"Yp05","../../models/schemaRelease":"Ys6U","./releaseProps":"iG5u"}],"aCHs":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("express")),a=t.default.Router(),s=require("../helper/other"),r=require("../helper/dbXmlQuery"),n=require("../helper/Release/getReleaseData"),i=require("../api/gtm"),u=require("../models/release"),l=e(require("../middleware/auth"));function d(e){return e.query.gtmVersion?+e.query.gtmVersion:+s.CONSTS.GTMVERSION}a.get("/",[l.default],(0,s.asyncRouteHandler)(async(e,t)=>{const{display:a}=e.query,{username:l,password:o,instance:p,url:c}=e.user,f=l.split(".")[0];if(a){const e=await(0,u.Release)(f,p).find({display:a}).sort({_id:1});if(e.length)return t.status(200).json({data:e})}const m=d(e),y=await(0,n.getReleaseSchema)(m);if(!y)return t.status(400).send(`gtmVersion:${m} schema not available!`);const{data:R,error:g}=await(0,s.asyncHandler)((0,i.dbXml)(c,r.getReleasePropsfromGtm,l,o));if(g)return t.status(400).send(g);const h=await(0,n.getReleaseData)(y,m,R,f);let w=await(0,u.Release)(f,p).find({}).sort({_id:1});return w&&0!==w.length?(w=await(0,n.getUpdatedProp)(h,w,p,f),a?t.status(200).json({data:w.filter(e=>e.display)}):t.status(200).json({data:w})):t.status(200).json({data:await(0,u.Release)(f,p).insertMany(h)})})),a.put("/",[l.default],(0,s.asyncRouteHandler)(async(e,t)=>{let{release:a}=e.body;const{username:s,instance:r}=e.user,n=s.split(".")[0];return a?(a=await(0,u.Release)(n,r).findByIdAndUpdate(a._id,a,{new:!0}),t.status(200).json({data:a})):t.status(400).send("Release prop value missing!")})),exports.default=a;
},{"../helper/other":"irtd","../helper/dbXmlQuery":"bJb7","../helper/Release/getReleaseData":"NFyl","../api/gtm":"KJs0","../models/release":"Yp05","../middleware/auth":"MNoc"}],"mbXe":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("winston"));function s(e,s,r,u){t.default.error(e.message,e),r.status(500).send("Something failed.")}exports.default=s;
},{}],"XNdw":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getChilds=void 0;const t=require("../renamer"),a=e(require("lodash")),r=require("../other"),n=e=>{const t={};return a.default.keys(e).map(e=>m(e,t)).filter(e=>void 0!==e),t},m=(e,t)=>{switch(!0){case-1!==e.search("Remark"):c(e,t,"Remark");break;case-1!==e.search("ItemFeature"):c(e,t,"ItemFeature");break;case-1!==e.search("GtmItemClassification"):c(e,t,"GtmItemClassification");break;case-1!==e.search("GtmItemDescription"):c(e,t,"GtmItemDescription");break;case-1!==e.search("GtmItemCountryOfOrigin"):c(e,t,"GtmItemCountryOfOrigin");break;case-1!==e.search("GtmItemUomConversion"):c(e,t,"GtmItemUomConversion");break;case-1!==e.search("Refnum"):c(e,t,"Refnum");break;case-1!==e.search("PricePerUnit"):c(e,t,"PricePerUnit");break;default:c(e,t,"Header")}return t},s=e=>{const t={Item:{},Packaging:{}};return a.default.keys(e).map(a=>{switch(!0){case-1===a.search("ItemMaster"):break;case-1!==a.search("Packaging"):i(a,e,t,"Packaging");break;default:i(a,e,t,"Item")}return t}).filter(e=>void 0!==e),t.Item=n(t.Item),t.Packaging=n(t.Packaging),{ItemMaster:t}};exports.getChilds=s;const i=(e,t,a,r)=>{a[`${r}`][`${e}`]=t[`${e}`]},c=(e,n,m)=>{let s=e,i=e;switch(!0){case"Remark"===m:s=(0,r.convertPath)(e,"Remark").newPath,i=(0,r.convertPath)(e,"Remark").newName;break;case"Refnum"===m:s=(0,r.convertPath)(e,"Refnum").newPath,i=(0,r.convertPath)(e,"Refnum").newName;break;case"ItemFeature"===m:s=(0,r.convertPath)(e,"ItemFeature").newPath,i=(0,r.convertPath)(e,"ItemFeature").newName;break;case"GtmItemClassification"===m:s=(0,r.convertPath)(e,"GtmItemClassification").newPath,i=(0,r.convertPath)(e,"GtmItemClassification").newName;break;case"GtmItemDescription"===m:s=(0,r.convertPath)(e,"GtmItemDescription").newPath,i=(0,r.convertPath)(e,"GtmItemDescription").newName;break;case"GtmItemCountryOfOrigin"===m:s=(0,r.convertPath)(e,"GtmItemCountryOfOrigin").newPath,i=(0,r.convertPath)(e,"GtmItemCountryOfOrigin").newName;break;case"GtmItemUomConversion"===m:s=(0,r.convertPath)(e,"GtmItemUomConversion").newPath,i=(0,r.convertPath)(e,"GtmItemUomConversion").newName}n[`${m}`]||(n[`${m}`]=[]),n[`${m}`].push({name:(0,t.getElementName)(i),path:s}),n[`${m}`]=a.default.uniqBy(n[`${m}`],"name")};
},{"../renamer":"jN2X","../other":"irtd"}],"iDDx":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SchemaItem=void 0;const t=e(require("mongoose")),m=new t.default.Schema({xmlNs:{type:["String"]},gtmVersion:{type:"Number"},ItemMaster:{type:"Mixed"}});exports.SchemaItem=t.default.model("SchemaItem",m,"ItemSchema");
},{}],"RPHv":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.generateItemSchema=void 0;const t=require("./../index"),s=e(require("express")),a=s.default.Router(),r=e(require("path")),n=e(require("fast-xml-parser")),i=e(require("flat")),m=require("../helper/other"),o=require("../helper/Item/schemaItemProps"),u=require("../models/schemaItem");async function l(){const e=r.default.join(t.ROOT_DIR,"XMLs","Item.xml"),s=await(0,m.getFileData)(e),a=n.default.getTraversalObj(s,{}),l=n.default.convertToJson(a,{}),d=(0,i.default)(l),c=(0,o.getChilds)(d);let{gtmVersion:f,xmlNsOtm:g,xmlNsGtm:h}=(0,m.getXMlVersion)(s);return f||(f=Number(m.CONSTS.GTMVERSION)),new u.SchemaItem({xmlNs:[g,h],gtmVersion:f,...c}).save()}a.post("/",(0,m.asyncRouteHandler)(async(e,s)=>{const a=r.default.join(t.ROOT_DIR,"XMLs","Item.xml"),l=await(0,m.getFileData)(a),d=n.default.getTraversalObj(l,{}),c=n.default.convertToJson(d,{}),f=(0,i.default)(c),g=(0,o.getChilds)(f),{gtmVersion:h,xmlNsOtm:I,xmlNsGtm:x}=(0,m.getXMlVersion)(l);if(!h)return s.status(400).send("XML must contain Namespace");let O=await u.SchemaItem.findOne({gtmVersion:h});if(O){if(JSON.stringify(O.ItemMaster)===JSON.stringify(g.ItemMaster))return s.status(200).send(O);await u.SchemaItem.findByIdAndRemove(O._id)}return O=new u.SchemaItem({xmlNs:[I,x],gtmVersion:h,...g}),O=await O.save(),s.status(200).send(O)})),a.get("/",(0,m.asyncRouteHandler)(async(e,t)=>{const{gtmVersion:s}=e.query;if(!s){const e=await u.SchemaItem.find().sort({gtmVersion:-1});return t.status(200).send(e)}const a=await u.SchemaItem.findOne({gtmVersion:s});return a?t.status(200).send(a):t.status(400).send(`gtmVersion:${s} schema not available!`)})),exports.default=a,exports.generateItemSchema=l;
},{"./../index":"Focm","../helper/other":"irtd","../helper/Item/schemaItemProps":"XNdw","../models/schemaItem":"iDDx"}],"I17b":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getChilds=void 0;const t=require("../renamer"),a=e(require("lodash")),r=require("../other"),s=e=>{const t={};return a.default.keys(e).map(e=>n(e,t)).filter(e=>void 0!==e),t},n=(e,t)=>{switch(!0){case-1!==e.search("InvolvedParty"):l(e,t,"InvolvedParty");break;case-1!==e.search("Remark"):l(e,t,"Remark");break;case-1!==e.search("ItemAttributes"):l(e,t,"ItemAttributes");break;case-1!==e.search("Refnum"):l(e,t,"Refnum");break;case-1!==e.search("PricePerUnit"):l(e,t,"PricePerUnit");break;default:l(e,t,"Header")}return t},c=e=>{const t={Release:{},ReleaseLine:{}};return a.default.keys(e).map(a=>{switch(!0){case-1===a.search("Release")||a.search("ReleaseStatus")>-1:break;case-1!==a.search("ReleaseLine"):i(a,e,t,"ReleaseLine");break;default:i(a,e,t,"Release")}return t}).filter(e=>void 0!==e),t.Release=s(t.Release),t.ReleaseLine=s(t.ReleaseLine),{Release:t}};exports.getChilds=c;const i=(e,t,a,r)=>{a[`${r}`][`${e}`]=t[`${e}`]},l=(e,s,n)=>{let c=e,i=e;switch(!0){case"Remark"===n:c=(0,r.convertPath)(e,"Remark").newPath,i=(0,r.convertPath)(e,"Remark").newName;break;case"InvolvedParty"===n:c=(0,r.convertPath)(e,"InvolvedParty").newPath,i=(0,r.convertPath)(e,"InvolvedParty").newName;break;case"Refnum"===n:c=(0,r.convertPath)(e,"Refnum").newPath,i=(0,r.convertPath)(e,"Refnum").newName;break;case"ItemAttributes"===n:c=(0,r.convertPath)(e,"ItemAttributes").newPath,i=(0,r.convertPath)(e,"ItemAttributes").newName}s[`${n}`]||(s[`${n}`]=[]),s[`${n}`].push({name:(0,t.getElementName)(i),path:c}),s[`${n}`]=a.default.uniqBy(s[`${n}`],"name")};
},{"../renamer":"jN2X","../other":"irtd"}],"woBX":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("./../index"),s=e(require("express")),a=s.default.Router(),r=e(require("path")),n=e(require("fast-xml-parser")),i=e(require("flat")),l=require("../helper/other"),u=require("../helper/Release/schemaReleaseProps"),o=require("../models/schemaRelease");a.post("/",(0,l.asyncRouteHandler)(async(e,s)=>{const a=r.default.join(t.ROOT_DIR,"XMLs","OrderRelease.xml"),d=await(0,l.getFileData)(a),m=n.default.getTraversalObj(d,{}),c=n.default.convertToJson(m,{}),f=(0,i.default)(c),R=(0,u.getChilds)(f),{gtmVersion:h,xmlNsOtm:g,xmlNsGtm:p}=(0,l.getXMlVersion)(d);if(!h)return s.status(400).send("XML must contain Namespace");let O=await o.SchemaRelease.findOne({gtmVersion:h});if(O){if(JSON.stringify(O.Release)===JSON.stringify(R.Release))return s.status(200).send(O);await o.SchemaRelease.findByIdAndRemove(O._id)}return O=new o.SchemaRelease({xmlNs:[g,p],gtmVersion:h,...R}),O=await O.save(),s.status(200).send(O)})),a.get("/",(0,l.asyncRouteHandler)(async(e,t)=>{const{gtmVersion:s}=e.query;if(!s){const e=await o.SchemaRelease.find().sort({gtmVersion:-1});return t.status(200).send(e)}const a=await o.SchemaRelease.findOne({gtmVersion:s});return a?t.status(200).send(a):t.status(400).send(`gtmVersion:${s} schema not available!`)})),exports.default=a;
},{"./../index":"Focm","../helper/other":"irtd","../helper/Release/schemaReleaseProps":"I17b","../models/schemaRelease":"Ys6U"}],"z2rt":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Item=void 0;const t=e(require("mongoose")),o=new t.default.Schema({name:String,required:Boolean,disabled:Boolean,display:Boolean,isMandatory:Boolean,type:String,displayText:String,defaultValue:String,gtmVersion:Number,xmlNs:["String"],path:["Mixed"]}),r=(e,r)=>t.default.model("Item",o,`${e}_Item_${r}`);exports.Item=r;
},{}],"OaWk":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mapItemDescription=exports.mapRemark=exports.mapItemClassification=exports.mapItemFeature=exports.mapRefnum=exports.mapHeader=void 0;const e=require("../other"),t=require("../renamer"),a=["Item TransactionCode","Item ID DomainName","Item ID"],p=(t,a,p)=>{const i=(0,e.capitalize)(p.split("_").join(" "));return i.split(".")[1]?i.split(".")[1]:i},i=(e,t)=>{return e.findIndex(e=>e.path.search(t)>-1)};for(let u=0;u<e.getSequence.length;u++){e.getSequence[u]}const n=(e,p,i,n,r)=>({name:e.name,required:!0,disabled:(0,t.getMandatoryElement)(e.name,a),display:(0,t.getMandatoryElement)(e.name,a),isMandatory:(0,t.getMandatoryElement)(e.name,a),type:p,displayText:e.name,defaultValue:(0,t.getDefaultValue)(e.path,r),path:[e.path],gtmVersion:i,xmlNs:n});exports.mapHeader=n;const r=(a,n,r,s,l,m,o)=>{const u=i(n,"Xid"),d=i(n,"DomainName"),c=i(n,"RefnumValue"),h=i(n,"TransactionCode");return{name:a,required:!0,disabled:!1,display:!1,type:r,displayText:p(0,0,a),defaultValue:(0,t.getDefaultValue)(n[c].path,o),path:[{path:n[c].path.replace("INDEX",m),value:""},(0,e.getDomainName)(a,n[d].path.replace("INDEX",m)),(0,e.getTC)(a,n[h].path.replace("INDEX",m)),(0,e.getXID)(a,n[u].path.replace("INDEX",m))],gtmVersion:s,xmlNs:l}};exports.mapRefnum=r;const s=(a,n,r,s,l,m,o)=>{const u=i(n,"Xid"),d=i(n,"DomainName"),c=i(n,"ItemFeatureValue"),h=i(n,"TransactionCode");return{name:a,required:!0,disabled:!1,display:!1,type:r,displayText:p(0,0,a),defaultValue:(0,t.getDefaultValue)(n[c].path,o),path:[{path:n[c].path,value:""},(0,e.getDomainName)(a,n[d].path),(0,e.getTC)(a,n[h].path),(0,e.getXID)(a,n[u].path)],gtmVersion:s,xmlNs:l}};exports.mapItemFeature=s;const l=(a,p,n,r,s,l,m)=>{const o=i(p,"Xid"),u=i(p,"ClassificationCode"),d=i(p,"TransactionCode");return{name:`${a} Classification`,required:!0,disabled:!1,display:!1,type:n,displayText:`${a} Classification`,defaultValue:(0,t.getDefaultValue)(p[u].path,m),path:[{path:p[u].path,value:""},(0,e.getTC)(a,p[d].path),(0,e.getXID)(a,p[o].path)],gtmVersion:r,xmlNs:s}};exports.mapItemClassification=l;const m=(a,n,r,s,l,m,o)=>{const u=i(n,"Xid"),d=i(n,"DomainName"),c=i(n,"RemarkText"),h=i(n,"RemarkSequence"),D=i(n,"TransactionCode");return{name:a,required:!0,disabled:!1,display:!1,type:r,displayText:p(0,0,a),defaultValue:(0,t.getDefaultValue)(n[c].path,o),path:[{path:n[c].path.replace("INDEX",m),value:""},(0,e.getTC)(a,n[D].path.replace("INDEX",m)),(0,e.getSequence)(a,n[h].path.replace("INDEX",m),m),(0,e.getDomainName)(a,n[d].path.replace("INDEX",m)),(0,e.getXID)(a,n[u].path.replace("INDEX",m))],gtmVersion:s,xmlNs:l}};exports.mapRemark=m;const o=(a,p,n,r,s,l,m)=>{const o=i(p,"Xid"),u=i(p,"DomainName"),d=i(p,":Description"),c=i(p,"SequenceNumber"),h=i(p,"TransactionCode");return{name:`Description in ${a.split("::")[1]}`,required:!0,disabled:!1,display:!1,type:n,displayText:`Description in ${a.split("::")[1]}`,defaultValue:(0,t.getDefaultValue)(p[d].path,m),path:[{path:p[d].path,value:""},(0,e.getTC)(a.split("::")[0],p[h].path),(0,e.getSequence)(a.split("::")[0],p[c].path,l),(0,e.getDomainName)(a.split("::")[0],p[u].path),(0,e.getXID)(a.split("::")[0],p[o].path)],gtmVersion:r,xmlNs:s}};exports.mapItemDescription=o;
},{"../other":"irtd","../renamer":"jN2X"}],"UQUS":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getUpdatedProp=exports.getItemData=exports.getItemSchema=void 0;const t=e(require("lodash")),n=e(require("promise-memoize")),m=require("../../models/item"),a=require("../../models/schemaItem"),r=require("./itemProps");function i(e,n,m,a){return new Promise(function(r){let{Header:i,Remark:c,Refnum:f,GtmItemClassification:h,GtmItemDescription:g,ItemFeature:M}=e.ItemMaster.Item;const x=e.xmlNs;i=l(i,n,x,a),c=I(m,c,n,x,a),f=d(m,f,n,x,a),M=p(m,M,n,x,a),h=s(m,h,n,x,a),g=o(m,g,n,x,a),r(t.default.uniqBy([...i,...c,...f,...M,...h,...g],u()))})}function u(){return e=>e.name}function o(e,t,n,m,a){return t=e.match(/GTMITEMDESCRIPTIONS="(.*?)"/)[1].split(",").map(c(t,n,m,a))}function s(e,t,n,m,a){return t=e.match(/GTMITEMCLASSIFICATIONS="(.*?)"/)[1].split(",").map(f(t,n,m,a))}function c(e,t,n,m){return(a,i)=>(0,r.mapItemDescription)(a,e,"Item : Description",t,n,i,m)}function f(e,t,n,m){return(a,i)=>(0,r.mapItemClassification)(a,e,"Item : Classification",t,n,i,m)}function p(e,t,n,m,a){const i=e.match(/ITEMFEATURES="(.*?)"/)[1].split(",");return t=i.map((e,i)=>(0,r.mapItemFeature)(e,t,"Item : Feature",n,m,i,a))}function d(e,t,n,m,a){const i=e.match(/REFNUMS="(.*?)"/)[1].split(",");return t=i.map((e,i)=>(0,r.mapRefnum)(e,t,"Item : Refnum",n,m,i,a))}function I(e,t,n,m,a){const i=e.match(/REMARKS="(.*?)"/)[1].split(",");return t=i.map((e,i)=>(0,r.mapRemark)(e,t,"Item : Remark",n,m,i,a))}function l(e,t,n,m){return e=e.map(e=>(0,r.mapHeader)(e,"Item : Header",t,n,m))}function h(e,n,a,r){return new Promise(async function(i){const u=t.default.differenceWith(e,n,(e,t)=>e.name===t.name),o=t.default.differenceWith(n,e,(e,t)=>e.name===t.name);if(u.length>0){const e=await(0,m.Item)(r,a).insertMany(u);i([...n,...e])}else o.length>0?(await(0,m.Item)(r,a).deleteMany({_id:{$in:[...o.map(e=>e._id)]}}),i(t.default.differenceWith(n,o,(e,t)=>e.name===t.name))):i(n)})}function g(e){return a.SchemaItem.findOne({gtmVersion:e}).sort({_id:1})}exports.getItemSchema=(0,n.default)(g,{maxAge:6e4}),exports.getItemData=(0,n.default)(i,{maxAge:6e4}),exports.getUpdatedProp=(0,n.default)(h,{maxAge:6e4});
},{"../../models/item":"z2rt","../../models/schemaItem":"iDDx","./itemProps":"OaWk"}],"o5f2":[function(require,module,exports) {
"use strict";var t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const e=t(require("express")),a=e.default.Router(),r=require("../helper/other"),n=require("../helper/dbXmlQuery"),s=require("../helper/Item/getItemData"),u=require("../api/gtm"),i=require("../models/item"),o=t(require("../middleware/auth")),d=require("./schemaItem");async function c(t,e,a){return await(0,i.Item)(t,e).find({display:a}).sort({_id:1})}async function l(t,e,a){return t=await(0,i.Item)(e,a).findByIdAndUpdate(t._id,t,{new:!0})}async function m(t,e){return await(0,i.Item)(t,e).find({}).sort({_id:1})}function f(t){return{data:t.filter(t=>t.display)}}async function p(t,e,a){return{data:await(0,i.Item)(t,e).insertMany(a)}}function y(t){return!t||0===t.length}function w(t){return t.split(".")[0]}function I(t){return t.query.gtmVersion?+t.query.gtmVersion:+r.CONSTS.GTMVERSION}a.get("/",[o.default],(0,r.asyncRouteHandler)(async(t,e)=>{const{display:a}=t.query,{username:i,password:o,instance:l,url:g}=t.user,h=w(i);if(a){const t=await c(h,l,a);if(t.length)return e.status(200).json({data:t})}const q=I(t);let _=await(0,s.getItemSchema)(q);_||(_=await(0,d.generateItemSchema)());const{data:j,error:S}=await(0,r.asyncHandler)((0,u.dbXml)(g,n.getItemPropfromGtm,i,o));if(S)return e.status(400).send(S);const b=await(0,s.getItemData)(_,q,j,h);let M=await m(h,l);return y(M)?e.status(200).json(await p(h,l,b)):(M=await(0,s.getUpdatedProp)(b,M,l,h),a?e.status(200).json(f(M)):e.status(200).json({data:M}))})),a.put("/",[o.default],(0,r.asyncRouteHandler)(async(t,e)=>{const{instance:a,username:r}=t.user,n=w(r);let{item:s}=t.body;return s?(s=await l(s,n,a),e.status(200).json({data:s})):e.status(400).send("Item prop value missing!")})),exports.default=a;
},{"../helper/other":"irtd","../helper/dbXmlQuery":"bJb7","../helper/Item/getItemData":"UQUS","../api/gtm":"KJs0","../models/item":"z2rt","../middleware/auth":"MNoc","./schemaItem":"RPHv"}],"Yjam":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Location=void 0;const o=e(require("mongoose")),t=new o.default.Schema({name:String,required:Boolean,disabled:Boolean,display:Boolean,isMandatory:Boolean,type:String,displayText:String,defaultValue:String,gtmVersion:Number,xmlNs:["String"],path:["Mixed"]}),a=(e,a)=>o.default.model("Location",t,`${e}_Location_${a}`);exports.Location=a;
},{}],"EPD9":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SchemaLocation=void 0;const t=e(require("mongoose")),o=new t.default.Schema({xmlNs:{type:["String"]},gtmVersion:{type:"Number"},Location:{type:"Mixed"}});exports.SchemaLocation=t.default.model("SchemaLocation",o,"LocationSchema");
},{}],"Dqth":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mapAddressLine=exports.mapRemark=exports.mapRefnum=exports.mapHeader=void 0;const e=require("../other"),a=require("../renamer"),t=["Location TransactionCode","Location ID DomainName","Location ID","Party ID DomainName","Party ID","Party TransactionCode"],r=(a,t,r)=>{const p=(0,e.capitalize)(r.split("_").join(" "));return p.split(".")[1]?p.split(".")[1]:p},p=(e,a)=>{return e.findIndex(e=>e.path.search(a)>-1)};for(let o=0;o<e.getSequence.length;o++){e.getSequence[o]}const n=(e,r,p,n,l)=>({name:e.name,required:!0,disabled:(0,a.getMandatoryElement)(e.name,t),display:(0,a.getMandatoryElement)(e.name,t),type:r,displayText:e.name,defaultValue:(0,a.getDefaultValue)(e.path,l),path:[e.path],gtmVersion:p,xmlNs:n});exports.mapHeader=n;const l=(t,n,l,s,i,o,m)=>{const d=p(n,"Xid"),u=p(n,"DomainName"),c=p(n,"RefnumValue"),h=p(n,"TransactionCode");return{name:t,required:!0,disabled:!1,display:!1,type:l,displayText:r(0,0,t),defaultValue:(0,a.getDefaultValue)(n[c].path,m),path:[{path:n[c].path.replace("INDEX",o),value:""},(0,e.getDomainName)(t,n[u].path.replace("INDEX",o)),(0,e.getTC)(t,n[h].path.replace("INDEX",o)),(0,e.getXID)(t,n[d].path.replace("INDEX",o))],gtmVersion:s,xmlNs:i}};exports.mapRefnum=l;const s=(t,n,l,s,i,o,m)=>{const d=p(n,"Xid"),u=p(n,"DomainName"),c=p(n,"RemarkText"),h=p(n,"RemarkSequence"),D=p(n,"TransactionCode");return{name:t,required:!0,disabled:!1,display:!1,type:l,displayText:r(0,0,t),defaultValue:(0,a.getDefaultValue)(n[c].path,m),path:[{path:n[c].path.replace("INDEX",o),value:""},(0,e.getTC)(t,n[D].path.replace("INDEX",o)),(0,e.getSequence)(t,n[h].path.replace("INDEX",o),o),(0,e.getDomainName)(t,n[u].path.replace("INDEX",o)),(0,e.getXID)(t,n[d].path.replace("INDEX",o))],gtmVersion:s,xmlNs:i}};exports.mapRemark=s;const i=(a,t,p,n,l,s,i,o)=>{return{name:`${i} ${a}`.trim(),required:!0,disabled:!1,display:!1,type:p,displayText:`${i} ${r(0,0,a)}`.trim(),defaultValue:"",path:[{path:t[1].path.replace("INDEX",s),value:""},(0,e.getSequence)(a,t[0].path.replace("INDEX",s),s)],gtmVersion:n,xmlNs:l}};exports.mapAddressLine=i;
},{"../other":"irtd","../renamer":"jN2X"}],"wmMx":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getUpdatedProp=exports.getLocationData=exports.getLocationSchema=void 0;const a=e(require("lodash")),t=e(require("promise-memoize")),o=require("../../models/location"),n=require("../../models/schemaLocation"),i=require("./locationProps");function r(e,t,o,n){return new Promise(function(r){let{Header:d,Remark:c,Refnum:m}=e.Location,{AddressLines:s}=e.Location,{Header:u}=e.Location.Contact,{Header:p}=e.Location.ServiceProvider;const f=e.xmlNs;d=d.map(e=>(0,i.mapHeader)(e,"Location : Header",t,f,n)),u=u.map(e=>(0,i.mapHeader)(e,"Party : Header",t,f,n)),p=p.map(e=>(0,i.mapHeader)(e,"ServiceProvider : Header",t,f,n));const l=o.match(/REMARKS="(.*?)"/)[1].split(",");c=l.map((e,a)=>(0,i.mapRemark)(e,c,"Location : Remark",t,f,a,n));const L=o.match(/REFNUMS="(.*?)"/)[1].split(",");m=L.map((e,a)=>(0,i.mapRefnum)(e,m,"Location : Refnum",t,f,a,n)),s=[1,2,3].map(e=>(0,i.mapAddressLine)(`Address Line ${e}`,s,"Location : Address Line",t,f,e-1,"",n)),r(a.default.uniqBy([...d,...c,...m,...s,...u,...p],e=>e.name))})}function d(e,t,n,i){return new Promise(async function(r){const d=a.default.differenceWith(e,t,(e,a)=>e.name===a.name),c=a.default.differenceWith(t,e,(e,a)=>e.name===a.name);if(d.length>0){const e=await(0,o.Location)(i,n).insertMany(d);r([...t,...e])}else c.length>0?(await(0,o.Location)(i,n).deleteMany({_id:{$in:[...c.map(e=>e._id)]}}),r(a.default.differenceWith(t,c,(e,a)=>e.name===a.name))):r(t)})}function c(e){return n.SchemaLocation.findOne({gtmVersion:e}).sort({_id:1})}exports.getLocationSchema=(0,t.default)(c,{maxAge:6e4}),exports.getLocationData=(0,t.default)(r,{maxAge:6e4}),exports.getUpdatedProp=(0,t.default)(d,{maxAge:6e4});
},{"../../models/location":"Yjam","../../models/schemaLocation":"EPD9","./locationProps":"Dqth"}],"pk3O":[function(require,module,exports) {
"use strict";var t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const e=t(require("express")),a=e.default.Router(),r=require("../helper/other"),s=require("../helper/dbXmlQuery"),n=require("../helper/Location/getLocationData"),o=require("../api/gtm"),i=require("../models/location"),u=t(require("../middleware/auth"));function d(t){return t.query.gtmVersion?+t.query.gtmVersion:+r.CONSTS.GTMVERSION}a.get("/",[u.default],(0,r.asyncRouteHandler)(async(t,e)=>{const{display:a}=t.query,{username:u,password:l,instance:c,url:p}=t.user,f=u.split(".")[0];if(a){const t=await(0,i.Location)(f,c).find({display:a}).sort({_id:1});if(t.length)return e.status(200).json({data:t})}const m=d(t),y=await(0,n.getLocationSchema)(m);if(!y)return e.status(400).send(`gtmVersion:${m} schema not available!`);const{data:g,error:h}=await(0,r.asyncHandler)((0,o.dbXml)(p,s.getLocationPropfromOtm,u,l));if(h)return e.status(400).send(h);const w=await(0,n.getLocationData)(y,m,g,f);let q=await(0,i.Location)(f,c).find({}).sort({_id:1});return q&&0!==q.length?(q=await(0,n.getUpdatedProp)(w,q,c,f),a?e.status(200).json({data:q.filter(t=>t.display)}):e.status(200).json({data:q})):e.status(200).json({data:await(0,i.Location)(f,c).insertMany(w)})})),a.put("/",[u.default],(0,r.asyncRouteHandler)(async(t,e)=>{let{location:a}=t.body;const{username:r,instance:s}=t.user,n=r.split(".")[0];return a?(a=await(0,i.Location)(n,s).findByIdAndUpdate(a._id,a,{new:!0}),e.status(200).json({data:a})):e.status(400).send("Location prop value missing!")})),exports.default=a;
},{"../helper/other":"irtd","../helper/dbXmlQuery":"bJb7","../helper/Location/getLocationData":"wmMx","../api/gtm":"KJs0","../models/location":"Yjam","../middleware/auth":"MNoc"}],"bvcS":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getChilds=void 0;const r=require("../renamer"),t=e(require("lodash")),a=require("../other"),s=e=>{const r={};return t.default.keys(e).map(e=>n(e,r)).filter(e=>void 0!==e),r},n=(e,r)=>{switch(!0){case-1!==e.search("Remark"):i(e,r,"Remark");break;case-1!==e.search("Refnum"):i(e,r,"Refnum");break;case-1!==e.search("AddressLines"):i(e,r,"AddressLines");break;default:i(e,r,"Header")}return r},o=e=>{const r={Locations:{},Contact:{},ServiceProvider:{}};return t.default.keys(e).map(t=>{switch(!0){case-1===t.search("Location"):break;case-1!==t.search("Contact"):c(t,e,r,"Contact");break;case-1!==t.search("ServiceProvider"):c(t,e,r,"ServiceProvider");break;default:c(t,e,r,"Locations")}return r}).filter(e=>void 0!==e),r.Locations=s(r.Locations),r.Contact=s(r.Contact),r.ServiceProvider=s(r.ServiceProvider),r.Locations.Contact={...r.Contact},r.Locations.ServiceProvider={...r.ServiceProvider},{Location:r.Locations}};exports.getChilds=o;const c=(e,r,t,a)=>{t[`${a}`][`${e}`]=r[`${e}`]},i=(e,s,n)=>{let o=e,c=e;switch(!0){case"Remark"===n:o=(0,a.convertPath)(e,"Remark").newPath,c=(0,a.convertPath)(e,"Remark").newName;break;case"Refnum"===n:o=(0,a.convertPath)(e,"Refnum").newPath,c=(0,a.convertPath)(e,"Refnum").newName;break;case"AddressLines"===n:o=(0,a.convertPath)(e,"AddressLines").newPath,c=(0,a.convertPath)(e,"AddressLines").newName}s[`${n}`]||(s[`${n}`]=[]),s[`${n}`].push({name:(0,r.getElementName)(c),path:o}),s[`${n}`]=t.default.uniqBy(s[`${n}`],"name")};
},{"../renamer":"jN2X","../other":"irtd"}],"ZmvT":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("./../index"),a=e(require("express")),s=a.default.Router(),n=e(require("path")),r=e(require("fast-xml-parser")),i=e(require("flat")),o=require("../helper/other"),u=require("../helper/Location/schemaLocationProps"),c=require("../models/schemaLocation");s.post("/",(0,o.asyncRouteHandler)(async(e,a)=>{const s=n.default.join(t.ROOT_DIR,"XMLs","Location.xml"),l=await(0,o.getFileData)(s),d=r.default.getTraversalObj(l,{}),m=r.default.convertToJson(d,{}),f=(0,i.default)(m),h=(0,u.getChilds)(f),{gtmVersion:g,xmlNsOtm:L,xmlNsGtm:p}=(0,o.getXMlVersion)(l);if(!g)return a.status(400).send("XML must contain Namespace");let q=await c.SchemaLocation.findOne({gtmVersion:g});if(q){if(JSON.stringify(q.Location)===JSON.stringify(h.Location))return a.status(200).send(q);await c.SchemaLocation.findByIdAndRemove(q._id)}return q=new c.SchemaLocation({xmlNs:[L,p],gtmVersion:g,...h}),q=await q.save(),a.status(200).send(q)})),s.get("/",(0,o.asyncRouteHandler)(async(e,t)=>{const{gtmVersion:a}=e.query;if(!a){const e=await c.SchemaLocation.find().sort({gtmVersion:-1});return t.status(200).send(e)}const s=await c.SchemaLocation.findOne({gtmVersion:a});return s?t.status(200).send(s):t.status(400).send(`gtmVersion:${a} schema not available!`)})),exports.default=s;
},{"./../index":"Focm","../helper/other":"irtd","../helper/Location/schemaLocationProps":"bvcS","../models/schemaLocation":"EPD9"}],"Ovyc":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Party=void 0;const t=e(require("mongoose")),r=new t.default.Schema({name:String,required:Boolean,disabled:Boolean,display:Boolean,isMandatory:Boolean,type:String,displayText:String,defaultValue:String,gtmVersion:Number,xmlNs:["String"],path:["Mixed"]}),a=(e,a)=>t.default.model("Party",r,`${e}_Party_${a}`);exports.Party=a;
},{}],"axFa":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SchemaParty=void 0;const t=e(require("mongoose")),r=new t.default.Schema({xmlNs:{type:["String"]},gtmVersion:{type:"Number"},GtmContact:{type:"Mixed"}});exports.SchemaParty=t.default.model("SchemaParty",r,"PartySchema");
},{}],"Bhcp":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mapAddressLine=exports.mapRemark=exports.mapRefnum=exports.mapHeader=void 0;const e=require("../other"),a=require("../renamer"),t=require("../other"),r=["Party TransactionCode","Party ID DomainName","Party ID",...Object.values(t.NAME.party)],p=(a,t,r)=>{const p=(0,e.capitalize)(r.split("_").join(" "));return p.split(".")[1]?p.split(".")[1]:p},n=(e,a)=>{return e.findIndex(e=>e.path.search(a)>-1)};for(let d=0;d<e.getSequence.length;d++){e.getSequence[d]}const l=(e,t,p,n,l)=>({name:e.name,required:!0,disabled:(0,a.getMandatoryElement)(e.name,r),display:(0,a.getMandatoryElement)(e.name,r),isMandatory:(0,a.getMandatoryElement)(e.name,r),type:t,displayText:e.name,defaultValue:(0,a.getDefaultValue)(e.path,l),path:[e.path],gtmVersion:p,xmlNs:n});exports.mapHeader=l;const s=(t,r,l,s,i,m,d,o)=>{const u=n(r,"Xid"),c=n(r,"DomainName"),h=n(r,"RefnumValue"),D=n(r,"TransactionCode");return{name:`${d} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:l,displayText:`${d} ${p(0,0,t)}`.trim(),defaultValue:(0,a.getDefaultValue)(r[h].path,o),path:[{path:r[h].path.replace("INDEX",m),value:""},(0,e.getDomainName)(t,r[c].path.replace("INDEX",m)),(0,e.getTC)(t,r[D].path.replace("INDEX",m)),(0,e.getXID)(t,r[u].path.replace("INDEX",m))],gtmVersion:s,xmlNs:i}};exports.mapRefnum=s;const i=(t,r,l,s,i,m,d,o)=>{const u=n(r,"Xid"),c=n(r,"DomainName"),h=n(r,"RemarkText"),D=n(r,"RemarkSequence"),g=n(r,"TransactionCode");return{name:`${d} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:l,displayText:`${d} ${p(0,0,t)}`.trim(),defaultValue:(0,a.getDefaultValue)(r[h].path,o),path:[{path:r[h].path.replace("INDEX",m),value:""},(0,e.getTC)(t,r[g].path.replace("INDEX",m)),(0,e.getSequence)(t,r[D].path.replace("INDEX",m),m),(0,e.getDomainName)(t,r[c].path.replace("INDEX",m)),(0,e.getXID)(t,r[u].path.replace("INDEX",m))],gtmVersion:s,xmlNs:i}};exports.mapRemark=i;const m=(a,t,r,n,l,s,i,m)=>{return{name:`${i} ${a}`.trim(),required:!0,disabled:!1,display:!1,type:r,displayText:`${i} ${p(0,0,a)}`.trim(),defaultValue:"",path:[{path:t[1].path.replace("INDEX",s),value:""},(0,e.getSequence)(a,t[0].path.replace("INDEX",s),s)],gtmVersion:n,xmlNs:l}};exports.mapAddressLine=m;
},{"../other":"irtd","../renamer":"jN2X"}],"dEF4":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getUpdatedProp=exports.getPartyData=exports.getPartySchema=void 0;const t=e(require("lodash")),r=e(require("promise-memoize")),n=require("../../models/party"),a=require("../../models/schemaParty"),i=require("./partyProps");function o(e,r,n,a){return new Promise(function(i){let{Header:o,Remark:c,Refnum:p}=e.GtmContact.Contact,{Header:l}=e.GtmContact.LocationRef,{AddressLines:P}=e.GtmContact.LocationRef;const y=e.xmlNs;({PHeader:o,PLocRef:l}=f(o,r,y,a,l)),c=d(n,c,r,y,a),p=m(n,p,r,y,a),P=u(P,r,y,a),i(t.default.uniqBy([...o,...c,...p,...l,...P],s()))})}function u(e,t,r,n){return e=[1,2,3].map(c(e,t,r,n))}function m(e,t,r,n,a){return t=e.match(/REFNUMS="(.*?)"/)[1].split(",").map(p(t,r,n,a))}function d(e,t,r,n,a){return t=e.match(/REMARKS="(.*?)"/)[1].split(",").map(l(t,r,n,a))}function f(e,t,r,n,a){return{PHeader:e=e.map(y(t,r,n)),PLocRef:a=a.map(P(t,r,n))}}function s(){return e=>e.name}function c(e,t,r,n){return a=>(0,i.mapAddressLine)(`Address Line ${a}`,e,"Party : Address Line",t,r,a-1,"",n)}function p(e,t,r,n){return(a,o)=>(0,i.mapRefnum)(a,e,"Party : Refnum",t,r,o,"",n)}function l(e,t,r,n){return(a,o)=>(0,i.mapRemark)(a,e,"Party : Remark",t,r,o,"",n)}function P(e,t,r){return n=>(0,i.mapHeader)(n,"LocationRef : Header",e,t,r)}function y(e,t,r){return n=>(0,i.mapHeader)(n,"Party : Header",e,t,r)}function h(e,r,a,i){return new Promise(async function(o){const u=t.default.differenceWith(e,r,(e,t)=>e.name===t.name),m=t.default.differenceWith(r,e,(e,t)=>e.name===t.name);if(u.length>0){const e=await(0,n.Party)(i,a).insertMany(u);o([...r,...e])}else m.length>0?(await(0,n.Party)(i,a).deleteMany({_id:{$in:[...m.map(e=>e._id)]}}),o(t.default.differenceWith(r,m,(e,t)=>e.name===t.name))):o(r)})}function R(e){return a.SchemaParty.findOne({gtmVersion:e}).sort({_id:1})}exports.getPartySchema=(0,r.default)(R,{maxAge:6e4}),exports.getPartyData=(0,r.default)(o,{maxAge:6e4}),exports.getUpdatedProp=(0,r.default)(h,{maxAge:6e4});
},{"../../models/party":"Ovyc","../../models/schemaParty":"axFa","./partyProps":"Bhcp"}],"HAOJ":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getChilds=void 0;const t=require("../renamer"),a=e(require("lodash")),r=require("../other"),n=e=>{const t={};return a.default.keys(e).map(e=>s(e,t)).filter(e=>void 0!==e),t},s=(e,t)=>{switch(!0){case-1!==e.search("Remark"):i(e,t,"Remark");break;case-1!==e.search("Refnum"):i(e,t,"Refnum");break;case-1!==e.search("AddressLines"):i(e,t,"AddressLines");break;default:i(e,t,"Header")}return t},c=e=>{const t={Contact:{},LocationRef:{}};return a.default.keys(e).map(a=>{switch(!0){case-1===a.search("GtmContact"):break;case-1!==a.search("LocationRef"):o(a,e,t,"LocationRef");break;default:o(a,e,t,"Contact")}return t}).filter(e=>void 0!==e),t.Contact=n(t.Contact),t.LocationRef=n(t.LocationRef),{GtmContact:t}};exports.getChilds=c;const o=(e,t,a,r)=>{a[`${r}`][`${e}`]=t[`${e}`]},i=(e,n,s)=>{let c=e,o=e;switch(!0){case"Remark"===s:c=(0,r.convertPath)(e,"Remark").newPath,o=(0,r.convertPath)(e,"Remark").newName;break;case"Refnum"===s:c=(0,r.convertPath)(e,"Refnum").newPath,o=(0,r.convertPath)(e,"Refnum").newName;break;case"AddressLines"===s:c=(0,r.convertPath)(e,"AddressLines").newPath,o=(0,r.convertPath)(e,"AddressLines").newName}n[`${s}`]||(n[`${s}`]=[]),n[`${s}`].push({name:(0,t.getElementName)(o),path:c}),n[`${s}`]=a.default.uniqBy(n[`${s}`],"name")};
},{"../renamer":"jN2X","../other":"irtd"}],"abiS":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.generatePartySchema=void 0;const t=require("./../index"),a=e(require("express")),r=a.default.Router(),s=e(require("path")),n=e(require("fast-xml-parser")),i=e(require("flat")),o=require("../helper/other"),u=require("../helper/Party/schemaPartyProps"),l=require("../models/schemaParty");async function m(){const e=s.default.join(t.ROOT_DIR,"XMLs","Party.xml"),a=await(0,o.getFileData)(e),r=n.default.getTraversalObj(a,{}),m=n.default.convertToJson(r,{}),d=(0,i.default)(m),c=(0,u.getChilds)(d);let{gtmVersion:f,xmlNsOtm:y,xmlNsGtm:g}=(0,o.getXMlVersion)(a);return f||(f=Number(o.CONSTS.GTMVERSION)),new l.SchemaParty({xmlNs:[y,g],gtmVersion:f,...c}).save()}r.post("/",(0,o.asyncRouteHandler)(async(e,a)=>{const r=s.default.join(t.ROOT_DIR,"XMLs","Party.xml"),m=await(0,o.getFileData)(r),d=n.default.getTraversalObj(m,{}),c=n.default.convertToJson(d,{}),f=(0,i.default)(c),y=(0,u.getChilds)(f),{gtmVersion:g,xmlNsOtm:h,xmlNsGtm:x}=(0,o.getXMlVersion)(m);if(!g)return a.status(400).send("XML must contain Namespace");let O=await l.SchemaParty.findOne({gtmVersion:g});if(O){if(JSON.stringify(O.GtmContact)===JSON.stringify(y.GtmContact))return a.status(200).send(O);await l.SchemaParty.findByIdAndRemove(O._id)}return O=new l.SchemaParty({xmlNs:[h,x],gtmVersion:g,...y}),O=await O.save(),a.status(200).send(O)})),r.get("/",(0,o.asyncRouteHandler)(async(e,t)=>{const{gtmVersion:a}=e.query;if(!a){const e=await l.SchemaParty.find().sort({gtmVersion:-1});return t.status(200).send(e)}const r=await l.SchemaParty.findOne({gtmVersion:a});return r?t.status(200).send(r):t.status(400).send(`gtmVersion:${a} schema not available!`)})),exports.default=r,exports.generatePartySchema=m;
},{"./../index":"Focm","../helper/other":"irtd","../helper/Party/schemaPartyProps":"HAOJ","../models/schemaParty":"axFa"}],"TT7J":[function(require,module,exports) {
"use strict";var t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const e=t(require("express")),a=e.default.Router(),r=require("../helper/other"),n=require("../helper/dbXmlQuery"),s=require("../helper/Party/getPartyData"),u=require("../api/gtm"),i=require("../models/party"),o=t(require("../middleware/auth")),d=require("./schemaParty");async function y(t,e,a){return await(0,i.Party)(t,e).find({display:a}).sort({_id:1})}async function l(t,e){return await(0,i.Party)(t,e).find({}).sort({_id:1})}function c(t){return{data:t.filter(t=>t.display)}}async function f(t,e,a){return{data:await(0,i.Party)(t,e).insertMany(a)}}function p(t){return!t||0===t.length}function m(t){return+t.query.gtmVersion||+r.CONSTS.GTMVERSION}function w(t){return t.split(".")[0]}a.get("/",[o.default],(0,r.asyncRouteHandler)(async(t,e)=>{const{display:a}=t.query,{username:i,password:o,instance:P,url:g}=t.user,h=w(i);if(a){const t=await y(h,P,a);if(t.length)return e.status(200).json({data:t})}const q=m(t);let _=await(0,s.getPartySchema)(q);_||(_=await(0,d.generatePartySchema)());const{data:j,error:S}=await(0,r.asyncHandler)((0,u.dbXml)(g,n.getPartyPropfromGtm,i,o));if(S)return e.status(400).send(S);const b=await(0,s.getPartyData)(_,q,j,h);let M=await l(h,P);return p(M)?e.status(200).json(await f(h,P,b)):(M=await(0,s.getUpdatedProp)(b,M,P,h),a?e.status(200).json(c(M)):e.status(200).json({data:M}))})),a.put("/",[o.default],(0,r.asyncRouteHandler)(async(t,e)=>{let{party:a}=t.body;const{username:r,instance:n}=t.user,s=w(r);return a?(a=await(0,i.Party)(s,n).findByIdAndUpdate(a._id,a,{new:!0}),e.status(200).json({data:a})):e.status(400).send("Party prop value missing!")})),exports.default=a;
},{"../helper/other":"irtd","../helper/dbXmlQuery":"bJb7","../helper/Party/getPartyData":"dEF4","../api/gtm":"KJs0","../models/party":"Ovyc","../middleware/auth":"MNoc","./schemaParty":"abiS"}],"fEfK":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Transaction=void 0;const t=e(require("mongoose")),a=new t.default.Schema({name:String,required:Boolean,disabled:Boolean,display:Boolean,isMandatory:Boolean,type:String,displayText:String,defaultValue:String,gtmVersion:Number,xmlNs:["String"],path:["Mixed"]}),o=(e,o)=>t.default.model("Transaction",a,`${e}_Transaction_${o}`);exports.Transaction=o;
},{}],"Poy0":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SchemaTransaction=void 0;const t=e(require("mongoose")),a=new t.default.Schema({xmlNs:{type:["String"]},gtmVersion:{type:"Number"},GtmTransaction:{type:"Mixed"}});exports.SchemaTransaction=t.default.model("SchemaTransaction",a,"TransactionSchema");
},{}],"JLzc":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mapTrxLineItemId=exports.mapDate=exports.mapInvolvedParty=exports.mapCurrency=exports.mapQuantity=exports.mapRemark=exports.mapRefnum=exports.mapHeader=void 0;const e=require("../other"),a=require("../renamer"),t=["Transaction ID DomainName","Transaction ID","Transaction TransactionCode","Line ID DomainName","Line ID","Line TransactionCode"],r=(a,t,r)=>{const p=(0,e.capitalize)(r.split("_").join(" "));return p.split(".")[1]?p.split(".")[1]:p},p=(e,a)=>{return e.findIndex(e=>e.path.search(a)>-1)},i=(e,r,p,i,n)=>({name:e.name,required:!0,disabled:(0,a.getMandatoryElement)(e.name,t),display:(0,a.getMandatoryElement)(e.name,t),type:r,displayText:e.name,defaultValue:(0,a.getDefaultValue)(e.path,n),isMandatory:(0,a.getMandatoryElement)(e.name,t),path:[e.path],gtmVersion:p,xmlNs:i});exports.mapHeader=i;const n=(t,i,n,l,m,u,s,d)=>{const o=p(i,"Xid"),D=p(i,"DomainName"),c=p(i,"RefnumValue"),h=p(i,"TransactionCode");return{name:`${s} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${s} ${r(0,0,t)}`.trim(),defaultValue:(0,a.getDefaultValue)(i[c].path,d),path:[{path:i[c].path.replace("INDEX",u),value:""},(0,e.getDomainName)(t,i[D].path.replace("INDEX",u)),(0,e.getTC)(t,i[h].path.replace("INDEX",u)),(0,e.getXID)(t,i[o].path.replace("INDEX",u))],gtmVersion:l,xmlNs:m}};exports.mapRefnum=n;const l=(t,i,n,l,m,u,s,d)=>{const o=p(i,"Xid"),D=p(i,"DomainName"),c=p(i,"RemarkText"),h=p(i,"RemarkSequence"),y=p(i,"TransactionCode");return{name:`${s} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${s} ${r(0,0,t)}`.trim(),defaultValue:(0,a.getDefaultValue)(i[c].path,d),path:[{path:i[c].path.replace("INDEX",u),value:""},(0,e.getTC)(t,i[y].path.replace("INDEX",u)),(0,e.getSequence)(t,i[h].path.replace("INDEX",u),u),(0,e.getDomainName)(t,i[D].path.replace("INDEX",u)),(0,e.getXID)(t,i[o].path.replace("INDEX",u))],gtmVersion:l,xmlNs:m}};exports.mapRemark=l;const m=(t,i,n,l,m,u,s,d,o)=>o[t.replace(/.*\[|\]/gi,"")].map(o=>{t=t.split("[")[0];const D=p(i,/QuantityTypeGid(.*?)Xid/),c=p(i,/QuantityTypeGid(.*?)DomainName/),h=p(i,/Quantity(.*?)QuantityValue/),y=p(i,/Quantity(.*?)SequenceNumber/),I=p(i,/Quantity(.*?)TransactionCode/),N=p(i,/Quantity(.*?)UOM/);return{name:`${s} ${t} (${o})`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${s} ${r(0,0,t)} (${o})`.trim(),defaultValue:(0,a.getDefaultValue)(i[h].path,d),path:[{path:i[h].path.replace("INDEX",u),value:""},(0,e.getTC)(t,i[I].path.replace("INDEX",u)),(0,e.getSequence)(t,i[y].path.replace("INDEX",u),u),(0,e.getDomainName)(t,i[c].path.replace("INDEX",u)),{path:i[N].path.replace("INDEX",u),value:o},(0,e.getXID)(t,i[D].path.replace("INDEX",u))],gtmVersion:l,xmlNs:m}});exports.mapQuantity=m;const u=(t,i,n,l,m,u,s,d)=>{const o=p(i,/GtmCurrencyTypeGid(.*?)Xid/),D=p(i,/GtmCurrencyTypeGid(.*?)DomainName/),c=p(i,/CurrencyValue(.*?)MonetaryAmount/),h=p(i,/CurrencyValue(.*?)GlobalCurrencyCode/);return{name:`${s} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${s} ${r(0,0,t)}`.trim(),defaultValue:(0,a.getDefaultValue)(i[c].path,d),path:[{path:i[c].path.replace("INDEX",u),value:""},(0,e.getDomainName)(t,i[D].path.replace("INDEX",u)),{path:i[h].path.replace("INDEX",u),value:"USD"},(0,e.getXID)(t,i[o].path.replace("INDEX",u))],gtmVersion:l,xmlNs:m}};exports.mapCurrency=u;const s=(t,i,n,l,m,u,s,d="")=>{const o=p(i,/InvolvedPartyQualifierGid(.*?)Xid/),D=p(i,/ContactGid(.*?)Xid/),c=p(i,/ContactGid(.*?)DomainName/),h=p(i,"TransactionCode");return{name:`${s} ${t} (Party ID)`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${s} ${r(0,0,t)} (Party ID)`.trim(),defaultValue:(0,a.getDefaultValue)(i[D].path,d),path:[{path:i[D].path.replace("INDEX",u),value:""},(0,e.getTC)(t,i[h].path.replace("INDEX",u)),{path:i[c].path.replace("INDEX",u),value:d},(0,e.getXID)(t,i[o].path.replace("INDEX",u))],gtmVersion:l,xmlNs:m}};exports.mapInvolvedParty=s;const d=(t,i,n,l,m,u,s,d="")=>{const o=p(i,/DateQualifierGid(.*?)Xid/),D=p(i,/TransactionDate(.*?)GLogDate/),c=p(i,/DateQualifierGid(.*?)DomainName/);return{name:`${s} ${t} (YYYY-MM-DD)`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${s} ${r(0,0,t)} (YYYY-MM-DD)`.trim(),defaultValue:(0,a.getDefaultValue)(i[D].path,d),path:[{path:i[D].path.replace("INDEX",u),value:""},(0,e.getDomainName)(t,i[c].path.replace("INDEX",u)),(0,e.getXID)(t,i[o].path.replace("INDEX",u))],gtmVersion:l,xmlNs:m}};exports.mapDate=d;const o=(e,a,t,r,i,n,l,m="")=>{const u=p(a,/ItemGid(.*?)Xid/),s=p(a,/ItemGid(.*?)DomainName/);return{name:`${l} Item ID`.trim(),required:!0,disabled:!1,display:!1,type:t,displayText:`${l} Item ID`.trim(),defaultValue:"",path:[{path:a[u].path.replace("INDEX",n),value:""},{path:a[s].path.replace("INDEX",n),value:m}],gtmVersion:r,xmlNs:i}};exports.mapTrxLineItemId=o;
},{"../other":"irtd","../renamer":"jN2X"}],"ZiiO":[function(require,module,exports) {
"use strict";var n=this&&this.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getUpdatedProp=exports.getTransactionData=exports.getTransactionSchema=void 0;const e=n(require("lodash")),t=n(require("promise-memoize")),r=require("../../models/transaction"),a=require("../../models/schemaTransaction"),i=require("./transactionProps");function u(n,t,r,a){return new Promise(function(i){let{Header:u,Remark:x,Refnum:L,InvolvedParty:y,TransDate:R,Quantity:D,Currency:h}=n.GtmTransaction.GtmTransaction,{Header:v,Remark:I,Refnum:P,InvolvedParty:g,ItemGid:E,TransLineDate:C,Quantity:Q,Currency:H}=n.GtmTransaction.GtmTransactionLine;const _=n.xmlNs;({TrxHeader:u,TrxLineHeader:v}=l(u,t,_,a,v)),({TrxRemark:x,TrxLineRemark:I}=d(r,x,t,_,a,I)),({TrxDate:R,TrxLineDate:C}=T(r,R,t,_,a,C)),({TrxQty:D,TrxLineQty:Q}=f(r,D,t,_,a,Q)),({TrxCur:h,TrxLineCur:H}=p(r,h,t,_,a,H)),E=s(E,t,_,a),({TrxRefnum:L,TrxLineRefnum:P}=m(r,L,t,_,a,P)),({TrxInvPty:y,TrxLineInvPty:g}=c(r,y,t,_,a,g)),i(e.default.uniqBy([...u,...x,...L,...y,...D,...h,...R,...v,...E,...I,...P,...g,...Q,...H,...C],o()))})}function o(){return n=>n.name}function c(n,e,t,r,a,i){const u=n.match(/INVOLVED_PARTY="(.*?)"/)[1].split(",");return{TrxInvPty:e=u.map(L(e,t,r,a)),TrxLineInvPty:i=u.map(x(i,t,r,a))}}function m(n,e,t,r,a,i){const u=n.match(/REFNUMS="(.*?)"/)[1].split(",");return{TrxRefnum:e=u.map(R(e,t,r,a)),TrxLineRefnum:i=u.map(y(i,t,r,a))}}function s(n,e,t,r){return n=[0].map(D(n,e,t,r))}function f(n,t,r,a,i,u){const o=n.match(/QUANTITY="(.*?)"/)[1].split(","),c=N(n);return{TrxQty:t=e.default.flattenDeep(o.map(P(t,r,a,i,c))),TrxLineQty:u=e.default.flattenDeep(o.map(h(u,r,a,i,c)))}}function p(n,e,t,r,a,i){const u=n.match(/CURRENCY="(.*?)"/)[1].split(",");return{TrxCur:e=u.map(I(e,t,r,a)),TrxLineCur:i=u.map(v(i,t,r,a))}}function T(n,e,t,r,a,i){const u=n.match(/DATES="(.*?)"/)[1].split(",");return{TrxDate:e=u.map(E(e,t,r,a)),TrxLineDate:i=u.map(g(i,t,r,a))}}function d(n,e,t,r,a,i){const u=n.match(/REMARKS="(.*?)"/)[1].split(",");return{TrxRemark:e=u.map(Q(e,t,r,a)),TrxLineRemark:i=u.map(C(i,t,r,a))}}function l(n,e,t,r,a){return{TrxHeader:n=n.map(_(e,t,r)),TrxLineHeader:a=a.map(H(e,t,r))}}function x(n,e,t,r){return(a,u)=>(0,i.mapInvolvedParty)(a,n,"Transaction Line : Involved Party",e,t,u,"Line",r)}function L(n,e,t,r){return(a,u)=>(0,i.mapInvolvedParty)(a,n,"Transaction : Involved Party",e,t,u,"",r)}function y(n,e,t,r){return(a,u)=>(0,i.mapRefnum)(a,n,"Transaction Line : Refnum",e,t,u,"Line",r)}function R(n,e,t,r){return(a,u)=>(0,i.mapRefnum)(a,n,"Transaction : Refnum",e,t,u,"",r)}function D(n,e,t,r){return(a,u)=>(0,i.mapTrxLineItemId)(a,n,"Transaction Line : Header",e,t,0,"Line",r)}function h(n,e,t,r,a){return(u,o)=>(0,i.mapQuantity)(u,n,"Transaction Line : Quantity",e,t,o,"Line",r,a)}function v(n,e,t,r){return(a,u)=>(0,i.mapCurrency)(a,n,"Transaction Line : Currency",e,t,u,"Line",r)}function I(n,e,t,r){return(a,u)=>(0,i.mapCurrency)(a,n,"Transaction : Currency",e,t,u,"",r)}function P(n,e,t,r,a){return(u,o)=>(0,i.mapQuantity)(u,n,"Transaction : Quantity",e,t,o,"",r,a)}function g(n,e,t,r){return(a,u)=>(0,i.mapDate)(a,n,"Transaction Line : Date",e,t,u,"Line",r)}function E(n,e,t,r){return(a,u)=>(0,i.mapDate)(a,n,"Transaction : Date",e,t,u,"",r)}function C(n,e,t,r){return(a,u)=>(0,i.mapRemark)(a,n,"Transaction Line : Remark",e,t,u,"Line",r)}function Q(n,e,t,r){return(a,u)=>(0,i.mapRemark)(a,n,"Transaction : Remark",e,t,u,"",r)}function H(n,e,t){return r=>(0,i.mapHeader)(r,"Transaction Line : Header",n,e,t)}function _(n,e,t){return r=>(0,i.mapHeader)(r,"Transaction : Header",n,e,t)}function k(n,t,a,i){return new Promise(async function(u){const o=e.default.differenceWith(n,t,(n,e)=>n.name===e.name),c=e.default.differenceWith(t,n,(n,e)=>n.name===e.name);if(o.length>0){const n=await(0,r.Transaction)(i,a).insertMany(o);u([...t,...n])}else c.length>0?(await(0,r.Transaction)(i,a).deleteMany({_id:{$in:[...c.map(n=>n._id)]}}),u(e.default.differenceWith(t,c,(n,e)=>n.name===e.name))):u(t)})}function U(n){return a.SchemaTransaction.findOne({gtmVersion:n}).sort({_id:1})}function N(n){const e=n.match(/QUANTITY_UOM="(.*?)"/)[1].split(","),t={};return e.forEach(n=>{t[n.replace(/.*\[|\]/gi,"")]?t[n.replace(/.*\[|\]/gi,"")].push(n.split("[")[0]):t[n.replace(/.*\[|\]/gi,"")]=[n.split("[")[0]],t["USER DEFINED"]?t["USER DEFINED"].push(n.split("[")[0]):t["USER DEFINED"]=[n.split("[")[0]]}),t}exports.getTransactionSchema=(0,t.default)(U,{maxAge:6e4}),exports.getTransactionData=(0,t.default)(u,{maxAge:6e4}),exports.getUpdatedProp=(0,t.default)(k,{maxAge:6e4});
},{"../../models/transaction":"fEfK","../../models/schemaTransaction":"Poy0","./transactionProps":"JLzc"}],"THe0":[function(require,module,exports) {
"use strict";var a=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getChilds=void 0;const e=require("../renamer"),t=a(require("lodash")),n=require("../other"),r=a=>{const e={};return t.default.keys(a).map(a=>c(a,e)).filter(a=>void 0!==a),e},c=(a,e)=>{switch(!0){case-1!==a.search("ItemGid"):i(a,e,"ItemGid");break;case-1!==a.search("Currency"):i(a,e,"Currency");break;case-1!==a.search("TransactionCurrency"):i(a,e,"TransactionCurrency");break;case-1!==a.search("Quantity"):i(a,e,"Quantity");break;case-1!==a.search("TransactionQuantity"):i(a,e,"TransactionQuantity");break;case-1!==a.search("TransLineDate"):i(a,e,"TransLineDate");break;case-1!==a.search("TransDate"):i(a,e,"TransDate");break;case-1!==a.search("TransactionInvLocation"):i(a,e,"TransactionInvLocation");break;case-1!==a.search("InvolvedParty"):i(a,e,"InvolvedParty");break;case-1!==a.search("UserDefinedClassification"):i(a,e,"UserDefinedClassification");break;case-1!==a.search("PortInfo"):i(a,e,"PortInfo");break;case-1!==a.search("Remark"):i(a,e,"Remark");break;case-1!==a.search("Refnum"):i(a,e,"Refnum");break;case-1!==a.search("Contact"):i(a,e,"Contact");break;default:i(a,e,"Header")}return e},s=a=>{const e={GtmTransaction:{},GtmTransactionLine:{}};return t.default.keys(a).map(t=>{switch(!0){case-1===t.search("GtmTransaction"):break;case-1!==t.search("GtmTransactionLine"):o(t,a,e,"GtmTransactionLine");break;default:o(t,a,e,"GtmTransaction")}return e}).filter(a=>void 0!==a),e.GtmTransaction=r(e.GtmTransaction),e.GtmTransactionLine=r(e.GtmTransactionLine),{GtmTransaction:e}};exports.getChilds=s;const o=(a,e,t,n)=>{t[`${n}`][`${a}`]=e[`${a}`]},i=(a,r,c)=>{let s=a,o=a;switch(!0){case"ItemGid"===c:s=(0,n.convertPath)(a,"ItemGid").newPath,o=(0,n.convertPath)(a,"ItemGid").newName;break;case"Currency"===c:s=(0,n.convertPath)(a,"Currency").newPath,o=(0,n.convertPath)(a,"Currency").newName;break;case"TransactionCurrency"===c:s=(0,n.convertPath)(a,"TransactionCurrency").newPath,o=(0,n.convertPath)(a,"TransactionCurrency").newName;break;case"Quantity"===c:s=(0,n.convertPath)(a,"Quantity").newPath,o=(0,n.convertPath)(a,"Quantity").newName;break;case"TransactionQuantity"===c:s=(0,n.convertPath)(a,"TransactionQuantity").newPath,o=(0,n.convertPath)(a,"TransactionQuantity").newName;break;case"TransLineDate"===c:s=(0,n.convertPath)(a,"TransLineDate").newPath,o=(0,n.convertPath)(a,"TransLineDate").newName;break;case"TransDate"===c:s=(0,n.convertPath)(a,"TransDate").newPath,o=(0,n.convertPath)(a,"TransDate").newName;break;case"TransactionInvLocation"===c:s=(0,n.convertPath)(a,"TransactionInvLocation").newPath,o=(0,n.convertPath)(a,"TransactionInvLocation").newName;break;case"UserDefinedClassification"===c:s=(0,n.convertPath)(a,"UserDefinedClassification").newPath,o=(0,n.convertPath)(a,"UserDefinedClassification").newName;break;case"Remark"===c:s=(0,n.convertPath)(a,"Remark").newPath,o=(0,n.convertPath)(a,"Remark").newName;break;case"PortInfo"===c:s=(0,n.convertPath)(a,"PortInfo").newPath,o=(0,n.convertPath)(a,"PortInfo").newName;break;case"Refnum"===c:s=(0,n.convertPath)(a,"Refnum").newPath,o=(0,n.convertPath)(a,"Refnum").newName;break;case"InvolvedParty"===c:s=(0,n.convertPath)(a,"InvolvedParty").newPath,o=(0,n.convertPath)(a,"InvolvedParty").newName;break;case"Contact"===c:s=(0,n.convertPath)(a,"Contact").newPath,o=(0,n.convertPath)(a,"Contact").newName}r[`${c}`]||(r[`${c}`]=[]),r[`${c}`].push({name:(0,e.getElementName)(o),path:s}),r[`${c}`]=t.default.uniqBy(r[`${c}`],"name")};
},{"../renamer":"jN2X","../other":"irtd"}],"DV7a":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.generateTrxSchema=void 0;const t=require("./../index"),a=e(require("express")),s=a.default.Router(),n=e(require("path")),r=e(require("fast-xml-parser")),i=e(require("flat")),o=require("../helper/other"),u=require("../helper/Transaction/schemaTransactionProps"),c=require("../models/schemaTransaction");async function m(){const e=n.default.join(t.ROOT_DIR,"XMLs","GtmTransaction.xml"),a=await(0,o.getFileData)(e),s=r.default.getTraversalObj(a,{}),m=r.default.convertToJson(s,{}),l=(0,i.default)(m),d=(0,u.getChilds)(l);let{gtmVersion:f,xmlNsOtm:T,xmlNsGtm:g}=(0,o.getXMlVersion)(a);return f||(f=Number(o.CONSTS.GTMVERSION)),new c.SchemaTransaction({xmlNs:[T,g],gtmVersion:f,...d}).save()}s.post("/",(0,o.asyncRouteHandler)(async(e,a)=>{const s=n.default.join(t.ROOT_DIR,"XMLs","GtmTransaction.xml"),m=await(0,o.getFileData)(s),l=r.default.getTraversalObj(m,{}),d=r.default.convertToJson(l,{}),f=(0,i.default)(d),T=(0,u.getChilds)(f),{gtmVersion:g,xmlNsOtm:h,xmlNsGtm:x}=(0,o.getXMlVersion)(m);if(!g)return a.status(400).send("XML must contain Namespace");let O=await c.SchemaTransaction.findOne({gtmVersion:g});if(O){if(JSON.stringify(O.GtmTransaction)===JSON.stringify(T.GtmTransaction))return a.status(200).send(O);await c.SchemaTransaction.findByIdAndRemove(O._id)}return O=new c.SchemaTransaction({xmlNs:[h,x],gtmVersion:g,...T}),O=await O.save(),a.status(200).send(O)})),s.get("/",(0,o.asyncRouteHandler)(async(e,t)=>{const{gtmVersion:a}=e.query;if(!a){const e=await c.SchemaTransaction.find().sort({gtmVersion:-1});return t.status(200).send(e)}const s=await c.SchemaTransaction.findOne({gtmVersion:a});return s?t.status(200).send(s):t.status(400).send(`gtmVersion:${a} schema not available!`)})),exports.default=s,exports.generateTrxSchema=m;
},{"./../index":"Focm","../helper/other":"irtd","../helper/Transaction/schemaTransactionProps":"THe0","../models/schemaTransaction":"Poy0"}],"F2tt":[function(require,module,exports) {
"use strict";var t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const a=t(require("express")),e=a.default.Router(),n=require("../helper/other"),r=require("../helper/dbXmlQuery"),s=require("../helper/Transaction/getTransactionData"),i=require("../api/gtm"),u=require("../models/transaction"),o=t(require("../middleware/auth")),c=require("./schemaTransaction");async function d(t,a,e){return await(0,u.Transaction)(t,a).find({display:e}).sort({_id:1})}async function l(t,a,e){return t=await(0,u.Transaction)(a,e).findByIdAndUpdate(t._id,t,{new:!0})}async function f(t,a){return await(0,u.Transaction)(t,a).find({}).sort({_id:1})}function p(t){return{data:t.filter(t=>t.display)}}async function y(t,a,e){return{data:await(0,u.Transaction)(t,a).insertMany(e)}}function w(t){return!t||0===t.length}function m(t){return+t.query.gtmVersion||+n.CONSTS.GTMVERSION}function T(t){return t.split(".")[0]}e.get("/",[o.default],(0,n.asyncRouteHandler)(async(t,a)=>{const{display:e}=t.query,{username:u,password:o,instance:l,url:g}=t.user,h=T(u);if(e){const t=await d(h,l,e);if(t.length)return a.status(200).json({data:t})}const q=m(t);let _=await(0,s.getTransactionSchema)(q);_||(_=await(0,c.generateTrxSchema)());const{data:j,error:S}=await(0,n.asyncHandler)((0,i.dbXml)(g,r.getTransactionPropsfromGtm,u,o));if(S)return a.status(400).send(S);const b=await(0,s.getTransactionData)(_,q,j,h);let x=await f(h,l);return w(x)?a.status(200).json(await y(h,l,b)):(x=await(0,s.getUpdatedProp)(b,x,l,h),e?a.status(200).json(p(x)):a.status(200).json({data:x}))})),e.put("/",[o.default],(0,n.asyncRouteHandler)(async(t,a)=>{let{transaction:e}=t.body;const{username:n,instance:r}=t.user,s=T(n);return e?(e=await l(e,s,r),a.status(200).json({data:e})):a.status(400).send("Transaction prop value missing!")})),exports.default=e;
},{"../helper/other":"irtd","../helper/dbXmlQuery":"bJb7","../helper/Transaction/getTransactionData":"ZiiO","../api/gtm":"KJs0","../models/transaction":"fEfK","../middleware/auth":"MNoc","./schemaTransaction":"DV7a"}],"RHAm":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.OrderBase=void 0;const r=e(require("mongoose")),t=new r.default.Schema({name:String,required:Boolean,disabled:Boolean,display:Boolean,isMandatory:Boolean,type:String,displayText:String,defaultValue:String,gtmVersion:Number,xmlNs:["String"],path:["Mixed"]}),a=(e,a)=>r.default.model("OrderBase",t,`${e}_OrderBase_${a}`);exports.OrderBase=a;
},{}],"TARO":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SchemaOrderBase=void 0;const r=e(require("mongoose")),t=new r.default.Schema({xmlNs:{type:["String"]},gtmVersion:{type:"Number"},TransOrder:{type:"Mixed"}});exports.SchemaOrderBase=r.default.model("SchemaOrderBase",t,"OrderBaseSchema");
},{}],"cIXx":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mapItemDescription=exports.mapInvolvedParty=exports.mapItemClassification=exports.mapItemFeature=exports.mapRemark=exports.mapRefnum=exports.mapHeader=void 0;const e=require("../other"),t=require("../renamer"),a=require("../other"),i=["OrderBase ID DomainName","OrderBase ID","OrderBase TransactionCode","Line ID DomainName","Line ID","Line TransactionCode",...Object.values(a.NAME.orderBase).filter(e=>!e.includes("TimeZone"))],r=(t,a,i)=>{const r=(0,e.capitalize)(i.split("_").join(" "));return r.split(".")[1]?r.split(".")[1]:r};for(let c=0;c<e.getSequence.length;c++){e.getSequence[c]}const p=(e,t)=>{return e.findIndex(e=>e.path.search(t)>-1)},n=(e,a,r,p,n)=>({name:e.name,required:!0,disabled:(0,t.getMandatoryElement)(e.name,i),display:(0,t.getMandatoryElement)(e.name,i),isMandatory:(0,t.getMandatoryElement)(e.name,i),type:a,displayText:e.name,defaultValue:(0,t.getDefaultValue)(e.path,n),path:[e.path],gtmVersion:r,xmlNs:p});exports.mapHeader=n;const s=(a,i,n,s,l,o,m,d)=>{const u=p(i,"Xid"),c=p(i,"DomainName"),h=p(i,"RefnumValue"),D=p(i,"TransactionCode");return{name:`${m} ${a}`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${m} ${r(0,0,a)}`.trim(),defaultValue:(0,t.getDefaultValue)(i[h].path,d),path:[{path:i[h].path.replace("INDEX",o),value:""},(0,e.getDomainName)(a,i[c].path.replace("INDEX",o)),(0,e.getTC)(a,i[D].path.replace("INDEX",o)),(0,e.getXID)(a,i[u].path.replace("INDEX",o))],gtmVersion:s,xmlNs:l}};exports.mapRefnum=s;const l=(a,i,n,s,l,o,m,d)=>{const u=p(i,"Xid"),c=p(i,"DomainName"),h=p(i,"RemarkText"),D=p(i,"RemarkSequence"),g=p(i,"TransactionCode");return{name:`${m} ${a}`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${m} ${r(0,0,a)}`.trim(),defaultValue:(0,t.getDefaultValue)(i[h].path,d),path:[{path:i[h].path.replace("INDEX",o),value:""},(0,e.getTC)(a,i[g].path.replace("INDEX",o)),(0,e.getSequence)(a,i[D].path.replace("INDEX",o),o),(0,e.getDomainName)(a,i[c].path.replace("INDEX",o)),(0,e.getXID)(a,i[u].path.replace("INDEX",o))],gtmVersion:s,xmlNs:l}};exports.mapRemark=l;const o=(a,i,n,s,l,o,m,d)=>{const u=p(i,"Xid"),c=p(i,"DomainName"),h=p(i,"ItemFeatureValue"),D=p(i,"TransactionCode");return{name:`${m} ${a}`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${m} ${r(0,0,a)}`.trim(),defaultValue:(0,t.getDefaultValue)(i[h].path,d),path:[{path:i[h].path,value:""},(0,e.getDomainName)(a,i[c].path),(0,e.getTC)(a,i[D].path),(0,e.getXID)(a,i[u].path)],gtmVersion:s,xmlNs:l}};exports.mapItemFeature=o;const m=(a,i,r,n,s,l,o)=>{const m=p(i,"Xid"),d=p(i,"ClassificationCode"),u=p(i,"TransactionCode");return{name:`${a} Classification`,required:!0,disabled:!1,display:!1,type:r,displayText:`${a} Classification`,defaultValue:(0,t.getDefaultValue)(i[d].path,o),path:[{path:i[d].path,value:""},(0,e.getTC)(a,i[u].path),(0,e.getXID)(a,i[m].path)],gtmVersion:n,xmlNs:s}};exports.mapItemClassification=m;const d=(a,i,n,s,l,o,m,d="")=>{const u=p(i,/InvolvedPartyQualifierGid(.*?)Xid/),c=p(i,/ContactGid(.*?)Xid/),h=p(i,/ContactGid(.*?)DomainName/),D=p(i,"TransactionCode");return{name:`${m} ${a} Contact ID`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${m} ${r(0,0,a)} Contact ID`.trim(),defaultValue:(0,t.getDefaultValue)(i[c].path,d),path:[{path:i[c].path,value:""},(0,e.getTC)(a,i[D].path),{path:i[h].path,value:d},(0,e.getXID)(a,i[u].path)],gtmVersion:s,xmlNs:l}};exports.mapInvolvedParty=d;const u=(a,i,r,n,s,l,o)=>{const m=p(i,"Xid"),d=p(i,"DomainName"),u=p(i,":Description"),c=p(i,"SequenceNumber"),h=p(i,"TransactionCode");return{name:`Description in ${a.split("::")[1]}`,required:!0,disabled:!1,display:!1,type:r,displayText:`Description in ${a.split("::")[1]}`,defaultValue:(0,t.getDefaultValue)(i[u].path,o),path:[{path:i[u].path,value:""},(0,e.getTC)(a.split("::")[0],i[h].path),(0,e.getSequence)(a.split("::")[0],i[c].path,l),(0,e.getDomainName)(a.split("::")[0],i[d].path),(0,e.getXID)(a.split("::")[0],i[m].path)],gtmVersion:n,xmlNs:s}};exports.mapItemDescription=u;
},{"../other":"irtd","../renamer":"jN2X"}],"BAB7":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getUpdatedProp=exports.getOrderBaseData=exports.getOrderBaseSchema=void 0;const r=e(require("lodash")),a=e(require("promise-memoize")),t=require("../../models/orderBase"),n=require("../../models/schemaOrderBase"),s=require("./orderBaseProps");function d(e,a,t,n){return new Promise(function(d){let{Header:m,Remark:i,Refnum:o}=e.TransOrder.OrderBase,{Header:u,Remark:p,Refnum:f}=e.TransOrder.OrderBaseLine;const c=e.xmlNs;m=m.map(e=>(0,s.mapHeader)(e,"Order Base : Header",a,c,n)),u=u.map(e=>(0,s.mapHeader)(e,"Order Base Line : Header",a,c,n));const l=t.match(/REMARKS="(.*?)"/)[1].split(",");i=l.map((e,r)=>(0,s.mapRemark)(e,i,"Order Base : Remark",a,c,r,"",n)),p=l.map((e,r)=>(0,s.mapRemark)(e,p,"Order Base Line : Remark",a,c,r,"Line",n));const O=t.match(/REFNUMS="(.*?)"/)[1].split(",");o=O.map((e,r)=>(0,s.mapRefnum)(e,o,"Order Base : Refnum",a,c,r,"",n));const B=t.match(/LINE_REFNUMS="(.*?)"/)[1].split(",");f=B.map((e,r)=>(0,s.mapRefnum)(e,f,"Order Base Line : Refnum",a,c,r,"Line",n)),d(r.default.uniqBy([...m,...i,...o,...u,...p,...f],e=>e.name))})}function m(e,a,n,s){return new Promise(async function(d){const m=r.default.differenceWith(e,a,(e,r)=>e.name===r.name),i=r.default.differenceWith(a,e,(e,r)=>e.name===r.name);if(m.length>0){const e=await(0,t.OrderBase)(s,n).insertMany(m);d([...a,...e])}else i.length>0?(await(0,t.OrderBase)(s,n).deleteMany({_id:{$in:[...i.map(e=>e._id)]}}),d(r.default.differenceWith(a,i,(e,r)=>e.name===r.name))):d(a)})}function i(e){return n.SchemaOrderBase.findOne({gtmVersion:e}).sort({_id:1})}exports.getOrderBaseSchema=(0,a.default)(i,{maxAge:6e4}),exports.getOrderBaseData=(0,a.default)(d,{maxAge:6e4}),exports.getUpdatedProp=(0,a.default)(m,{maxAge:6e4});
},{"../../models/orderBase":"RHAm","../../models/schemaOrderBase":"TARO","./orderBaseProps":"cIXx"}],"Xt3B":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const r=e(require("express")),t=r.default.Router(),a=require("../helper/other"),s=require("../helper/dbXmlQuery"),n=require("../helper/OrderBase/getOrderBaseData"),d=require("../api/gtm"),u=require("../models/orderBase"),i=e(require("../middleware/auth"));function o(e){return e.query.gtmVersion?+e.query.gtmVersion:+a.CONSTS.GTMVERSION}t.get("/",[i.default],(0,a.asyncRouteHandler)(async(e,r)=>{const{display:t}=e.query,{username:i,password:l,instance:c,url:p}=e.user,f=i.split(".")[0];if(t){const e=await(0,u.OrderBase)(f,c).find({display:t}).sort({_id:1});if(e.length)return r.status(200).json({data:e})}const m=o(e),y=await(0,n.getOrderBaseSchema)(m);if(!y)return r.status(400).send(`gtmVersion:${m} schema not available!`);const{data:B,error:O}=await(0,a.asyncHandler)((0,d.dbXml)(p,s.getOrderBasePropsfromGtm,i,l));if(O)return r.status(400).send(O);const g=await(0,n.getOrderBaseData)(y,m,B,f),h=await(0,u.OrderBase)(f,c).find({}).sort({_id:1});return h&&0!==h.length?t?r.status(200).json({data:h.filter(e=>e.display)}):r.status(200).json({data:h}):r.status(200).json({data:await(0,u.OrderBase)(f,c).insertMany(g)})})),t.put("/",[i.default],(0,a.asyncRouteHandler)(async(e,r)=>{let{orderBase:t}=e.body;const{username:a,instance:s}=e.user,n=a.split(".")[0];return t?(t=await(0,u.OrderBase)(n,s).findByIdAndUpdate(t._id,t,{new:!0}),r.status(200).json({data:t})):r.status(400).send("OrderBase prop value missing!")})),exports.default=t;
},{"../helper/other":"irtd","../helper/dbXmlQuery":"bJb7","../helper/OrderBase/getOrderBaseData":"BAB7","../api/gtm":"KJs0","../models/orderBase":"RHAm","../middleware/auth":"MNoc"}],"k9TE":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getChilds=void 0;const r=require("../renamer"),t=e(require("lodash")),a=require("../other"),s=e=>{const r={};return t.default.keys(e).map(e=>n(e,r)).filter(e=>void 0!==e),r},n=(e,r)=>{switch(!0){case-1!==e.search("InvolvedParty"):u(e,r,"InvolvedParty");break;case-1!==e.search("Remark"):u(e,r,"Remark");break;case-1!==e.search("ItemAttributes"):u(e,r,"ItemAttributes");break;case-1!==e.search("Refnum"):u(e,r,"Refnum");break;default:u(e,r,"Header")}return r},c=e=>{const r={OrderBase:{},OrderBaseLine:{}};return t.default.keys(e).map(t=>{switch(!0){case-1===t.search("TransOrder"):break;case-1!==t.search("TransOrderLineDetail"):d(t,e,r,"OrderBaseLine");break;default:d(t,e,r,"OrderBase")}return r}).filter(e=>void 0!==e),r.OrderBase=s(r.OrderBase),r.OrderBaseLine=s(r.OrderBaseLine),{TransOrder:r}};exports.getChilds=c;const d=(e,r,t,a)=>{t[`${a}`][`${e}`]=r[`${e}`]},u=(e,s,n)=>{let c=e,d=e;switch(!0){case"Remark"===n:c=(0,a.convertPath)(e,"Remark").newPath,d=(0,a.convertPath)(e,"Remark").newName;break;case"InvolvedParty"===n:c=(0,a.convertPath)(e,"InvolvedParty").newPath,d=(0,a.convertPath)(e,"InvolvedParty").newName;break;case"Refnum"===n:c=(0,a.convertPath)(e,"Refnum").newPath,d=(0,a.convertPath)(e,"Refnum").newName;break;case"ItemAttributes"===n:c=(0,a.convertPath)(e,"ItemAttributes").newPath,d=(0,a.convertPath)(e,"ItemAttributes").newName}s[`${n}`]||(s[`${n}`]=[]),s[`${n}`].push({name:(0,r.getElementName)(d),path:c}),s[`${n}`]=t.default.uniqBy(s[`${n}`],"name")};
},{"../renamer":"jN2X","../other":"irtd"}],"KJCd":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const r=require("./../index"),t=e(require("express")),s=t.default.Router(),a=e(require("path")),n=e(require("fast-xml-parser")),i=e(require("flat")),d=require("../helper/other"),u=require("../helper/OrderBase/schemaOrderBaseProps"),o=require("../models/schemaOrderBase");s.post("/",(0,d.asyncRouteHandler)(async(e,t)=>{const s=a.default.join(r.ROOT_DIR,"XMLs","OrderBase.xml"),l=await(0,d.getFileData)(s),m=n.default.getTraversalObj(l,{}),c=n.default.convertToJson(m,{}),f=(0,i.default)(c),O=(0,u.getChilds)(f),{gtmVersion:h,xmlNsOtm:g,xmlNsGtm:p}=(0,d.getXMlVersion)(l);if(!h)return t.status(400).send("XML must contain Namespace");let B=await o.SchemaOrderBase.findOne({gtmVersion:h});if(B){if(JSON.stringify(B.TransOrder)===JSON.stringify(O.TransOrder))return t.status(200).send(B);await o.SchemaOrderBase.findByIdAndRemove(B._id)}return B=new o.SchemaOrderBase({xmlNs:[g,p],gtmVersion:h,...O}),B=await B.save(),t.status(200).send(B)})),s.get("/",(0,d.asyncRouteHandler)(async(e,r)=>{const{gtmVersion:t}=e.query;if(!t){const e=await o.SchemaOrderBase.find().sort({gtmVersion:-1});return r.status(200).send(e)}const s=await o.SchemaOrderBase.findOne({gtmVersion:t});return s?r.status(200).send(s):r.status(400).send(`gtmVersion:${t} schema not available!`)})),exports.default=s;
},{"./../index":"Focm","../helper/other":"irtd","../helper/OrderBase/schemaOrderBaseProps":"k9TE","../models/schemaOrderBase":"TARO"}],"OHIs":[function(require,module,exports) {
"use strict";function e(e,s,t){if(!e.user.isAdmin)return s.status(403).send("Access denied.");t()}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"YYHk":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&("get"in a?t.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,a)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),t=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(n){if(n&&n.__esModule)return n;var i={};if(null!=n)for(var a in n)"default"!==a&&Object.prototype.hasOwnProperty.call(n,a)&&e(i,n,a);return t(i,n),i},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const a=i(require("express")),s=a.default.Router(),r=i(require("fs")),u=i(require("path")),d=n(require("fs-extra")),l=require("util"),f=(0,l.promisify)(r.default.readFile),o=(0,l.promisify)(r.default.writeFile),c=i(require("multiparty")),_=i(require("../middleware/auth")),m=i(require("../middleware/admin")),y=require("../models/setting"),j=require("../helper/other");async function v(e,t){const n=await f(e);await o(t,n)}s.get("/",[_.default,m.default],(0,j.asyncRouteHandler)(async(e,t)=>{const{username:n,instance:i}=e.user,a=n.split(".")[0];r.default.readdir(u.default.join(__dirname,"..","csv",i,a),async(e,n)=>{const s=[];if(e)return!r.default.existsSync(u.default.join(__dirname,"..","csv"))&&r.default.mkdirSync(u.default.join(__dirname,"..","csv")),!r.default.existsSync(u.default.join(__dirname,"..","csv",i))&&r.default.mkdirSync(u.default.join(__dirname,"..","csv",i)),!r.default.existsSync(u.default.join(__dirname,"..","csv",i,a))&&r.default.mkdirSync(u.default.join(__dirname,"..","csv",i,a)),t.status(200).json({data:{files:[]}});for(let t=0;t<n.length;t++){const e=n[t].toString().split("$$$");s.push({id:t+1,uploaduser:e[0],userrole:e[1],uploaddate:e[2],filename:e[3]})}const d=await(0,y.Setting)(i).findOne();return t.status(200).json({data:{files:s,setting:d}})})})),s.post("/",[_.default],(0,j.asyncRouteHandler)(async(e,t)=>{const{username:n,instance:i}=e.user,a=n.split(".")[0];(new c.default.Form).parse(e,function(e,n,s){const d=s[Object.keys(s)[0]][0].fieldName;d||t.status(400).json("FileName not provided!");const l=s[Object.keys(s)[0]][0].path;return r.default.existsSync(u.default.join(__dirname,"..","csv"))||r.default.mkdirSync(u.default.join(__dirname,"..","csv")),r.default.existsSync(u.default.join(__dirname,"..","csv",i))||r.default.mkdirSync(u.default.join(__dirname,"..","csv",i)),r.default.existsSync(u.default.join(__dirname,"..","csv",i,a))||r.default.mkdirSync(u.default.join(__dirname,"..","csv",i,a)),v(l,u.default.join(__dirname,"..","csv",i,a,d)),t.status(200).json({data:"CSV saved to server."})})})),s.get("/files",[_.default,m.default],(0,j.asyncRouteHandler)(async(e,t)=>{const{username:n,instance:i}=e.user,a=n.split(".")[0],s=e.query.file;r.default.exists(u.default.join(__dirname,"..","csv",i,a,s),function(e){if(!e)return t.status(404).end(`File ${s} not found!`);r.default.readFile(u.default.join(__dirname,"..","csv",i,a,s),function(e,n){return e?t.status(500).end(`Error getting the file: ${e}.`):t.send(n.toString("UTF-8"))})})})),s.delete("/files",[_.default,m.default],async(e,t)=>{const{username:n,instance:i}=e.user,a=n.split(".")[0],s=e.query.file;r.default.exists(u.default.join(__dirname,"..","csv",i,a,s),function(e){if(!e)return t.status(404).end(`File ${s} not found!`);r.default.unlink(u.default.join(__dirname,"..","csv",i,a,s),function(e){return e?t.status(500).end(`Error deleting the file: ${e}.`):t.send({data:{success:!0}})})})}),s.delete("/files/all",[_.default,m.default],async(e,t)=>{const{username:n,instance:i}=e.user,a=n.split(".")[0];d.exists(u.default.join(__dirname,"..","csv",i,a),function(e){if(!e)return t.status(404).end("Files not found!");d.remove(u.default.join(__dirname,"..","csv",i,a),function(e){return e?t.status(500).end(`Error deleting the file: ${e}.`):t.send({data:{success:!0}})})})}),exports.default=s;
},{"../middleware/auth":"MNoc","../middleware/admin":"OHIs","../models/setting":"IMRL","../helper/other":"irtd"}],"UddP":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("express")),a=t.default.Router(),r=require("../helper/other"),s=require("../models/setting"),n=e(require("../middleware/auth"));a.get("/",[n.default],(0,r.asyncRouteHandler)(async(e,t)=>{const{instance:a,url:n}=e.user;let u=await(0,s.Setting)(a).findOne();return u?t.status(200).json({data:u}):(u=await(0,s.Setting)(a).create({url:n,version:+r.CONSTS.GTMVERSION}),t.status(200).json({data:u}))})),a.put("/",[n.default],(0,r.asyncRouteHandler)(async(e,t)=>{const{instance:a}=e.user;let{setting:r}=e.body;return r=await(0,s.Setting)(a).findByIdAndUpdate(r._id,r,{new:!0}),t.status(200).json({data:r})})),exports.default=a;
},{"../helper/other":"irtd","../models/setting":"IMRL","../middleware/auth":"MNoc"}],"Ytvl":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.TrackingEvent=void 0;const t=e(require("mongoose")),n=new t.default.Schema({name:String,required:Boolean,disabled:Boolean,display:Boolean,isMandatory:Boolean,type:String,displayText:String,defaultValue:String,gtmVersion:Number,xmlNs:["String"],path:["Mixed"]}),r=(e,r)=>t.default.model("TrackingEvent",n,`${e}_TrackingEvent_${r}`);exports.TrackingEvent=r;
},{}],"bLgw":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SchemaTrackingEvent=void 0;const t=e(require("mongoose")),r=new t.default.Schema({xmlNs:{type:["String"]},gtmVersion:{type:"Number"},ShipmentStatus:{type:"Mixed"}});exports.SchemaTrackingEvent=t.default.model("SchemaTrackingEvent",r,"TrackingEventSchema");
},{}],"sUtY":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mapRefnum=exports.mapHeader=void 0;const e=require("../other"),a=require("../renamer"),t=["Status Code ID","Status Code ID DomainName","Stop Sequence Num","Time Zone ID","Log Date","Responsible Party ID DomainName","Responsible Party ID"],p=(a,t,p)=>{const r=(0,e.capitalize)(p.split("_").join(" "));return r.split(".")[1]?r.split(".")[1]:r},r=(e,a)=>{return e.findIndex(e=>e.path.search(a)>-1)},n=(e,p,r,n,s)=>({name:e.name,required:!0,disabled:(0,a.getMandatoryElement)(e.name,t),display:(0,a.getMandatoryElement)(e.name,t),type:p,displayText:e.name,defaultValue:(0,a.getDefaultValue)(e.path,s),path:[e.path],gtmVersion:r,xmlNs:n});exports.mapHeader=n;const s=(t,n,s,l,m,u,d)=>{const D=r(n,"Xid"),c=r(n,"DomainName"),h=r(n,"ShipmentRefnumValue"),I=r(n,"TransactionCode");return{name:o(t),required:!0,disabled:i(t),display:i(t),type:s,displayText:o(p(0,0,t)),defaultValue:(0,a.getDefaultValue)(n[h].path,d),path:[{path:n[h].path.replace("INDEX",u),value:""},(0,e.getDomainName)(t,n[c].path.replace("INDEX",u)),(0,e.getTC)(t,n[I].path.replace("INDEX",u)),(0,e.getXID)(t,n[D].path.replace("INDEX",u))],gtmVersion:l,xmlNs:m}};exports.mapRefnum=s;const o=e=>"GLOG"===e.toUpperCase()?"Shipment ID":e,i=e=>"GLOG"===e.toUpperCase();
},{"../other":"irtd","../renamer":"jN2X"}],"GO0I":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getUpdatedProp=exports.getTrackingEventData=exports.getTrackingEventSchema=void 0;const t=e(require("lodash")),n=e(require("promise-memoize")),a=require("../../models/trackingEvent"),r=require("../../models/schemaTrackingEvent"),i=require("./trackingEventProps");function o(e,n,a,r){return new Promise(function(o){let{Header:c,Refnum:m}=e.ShipmentStatus;const s=e.xmlNs;c=c.map(e=>(0,i.mapHeader)(e,"TrackingEvent : Header",n,s,r));const u=a.match(/REFNUMS="(.*?)"/)[1].split(",");m=u.map((e,t)=>(0,i.mapRefnum)(e,m,"TrackingEvent : Refnum",n,s,t,r)),o(t.default.uniqBy([...c,...m],e=>e.name))})}function c(e,n,r,i){return new Promise(async function(o){const c=t.default.differenceWith(e,n,(e,t)=>e.name===t.name),m=t.default.differenceWith(n,e,(e,t)=>e.name===t.name);if(c.length>0){const e=await(0,a.TrackingEvent)(i,r).insertMany(c);o([...n,...e])}else m.length>0?(await(0,a.TrackingEvent)(i,r).deleteMany({_id:{$in:[...m.map(e=>e._id)]}}),o(t.default.differenceWith(n,m,(e,t)=>e.name===t.name))):o(n)})}function m(e){return r.SchemaTrackingEvent.findOne({gtmVersion:e}).sort({_id:1})}exports.getTrackingEventSchema=(0,n.default)(m,{maxAge:6e4}),exports.getTrackingEventData=(0,n.default)(o,{maxAge:6e4}),exports.getUpdatedProp=(0,n.default)(c,{maxAge:6e4});
},{"../../models/trackingEvent":"Ytvl","../../models/schemaTrackingEvent":"bLgw","./trackingEventProps":"sUtY"}],"J2kM":[function(require,module,exports) {
"use strict";var t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const e=t(require("express")),a=e.default.Router(),r=require("../helper/other"),n=require("../helper/dbXmlQuery"),s=require("../helper/TrackingEvent/getTrackingEventData"),i=require("../api/gtm"),u=require("../models/trackingEvent"),d=t(require("../middleware/auth"));a.get("/",[d.default],(0,r.asyncRouteHandler)(async(t,e)=>{const{display:a}=t.query,{username:d,password:o,instance:l,url:c}=t.user,g=d.split(".")[0];if(a){const t=await(0,u.TrackingEvent)(g,l).find({display:a}).sort({_id:1});if(t.length)return e.status(200).json({data:t})}const p=+t.query.gtmVersion||+r.CONSTS.GTMVERSION,f=await(0,s.getTrackingEventSchema)(p);if(!f)return e.status(400).send(`gtmVersion:${p} schema not available!`);const{data:v,error:m}=await(0,r.asyncHandler)((0,i.dbXml)(c,n.getTrackingEventPropfromOtm,d,o));if(m)return e.status(400).send(m);const y=await(0,s.getTrackingEventData)(f,p,v);let E=await(0,u.TrackingEvent)(g,l).find({}).sort({_id:1});return E&&0!==E.length?(E=await(0,s.getUpdatedProp)(y,E,l,g),a?e.status(200).json({data:E.filter(t=>t.display)}):e.status(200).json({data:E})):e.status(200).json({data:await(0,u.TrackingEvent)(g,l).insertMany(y)})})),a.put("/",[d.default],(0,r.asyncRouteHandler)(async(t,e)=>{const{instance:a,username:r}=t.user,n=r.split(".")[0];let{trackingEvent:s}=t.body;return s?(s=await(0,u.TrackingEvent)(n,a).findByIdAndUpdate(s._id,s,{new:!0}),e.status(200).json({data:s})):e.status(400).send("Tracking Event prop value missing!")})),exports.default=a;
},{"../helper/other":"irtd","../helper/dbXmlQuery":"bJb7","../helper/TrackingEvent/getTrackingEventData":"GO0I","../api/gtm":"KJs0","../models/trackingEvent":"Ytvl","../middleware/auth":"MNoc"}],"e4o2":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getChilds=void 0;const t=require("../renamer"),a=e(require("lodash")),r=require("../other"),s=e=>{const t={};return a.default.keys(e).map(e=>u(e,t)).filter(e=>void 0!==e),t},u=(e,t)=>{switch(!0){case-1!==e.search("Refnum"):h(e,t,"Refnum");break;default:h(e,t,"Header")}return t},n=e=>{const t={ShipmentStatus:{}};return a.default.keys(e).map(a=>{switch(!0){case-1===a.search("ShipmentStatus"):break;default:i(a,e,t,"ShipmentStatus")}return t}).filter(e=>void 0!==e),t.ShipmentStatus=s(t.ShipmentStatus),{ShipmentStatus:t.ShipmentStatus}};exports.getChilds=n;const i=(e,t,a,r)=>{a[`${r}`][`${e}`]=t[`${e}`]},h=(e,s,u)=>{let n=e,i=e;switch(!0){case"Refnum"===u:n=(0,r.convertPath)(e,"Refnum").newPath,i=(0,r.convertPath)(e,"Refnum").newName}s[`${u}`]||(s[`${u}`]=[]),s[`${u}`].push({name:(0,t.getElementName)(i),path:n}),s[`${u}`]=a.default.uniqBy(s[`${u}`],"name")};
},{"../renamer":"jN2X","../other":"irtd"}],"WFgW":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("./../index"),n=e(require("express")),r=n.default.Router(),a=e(require("path")),s=e(require("fast-xml-parser")),i=e(require("flat")),u=require("../helper/other"),o=require("../helper/TrackingEvent/schemaTrackingEventProps"),c=require("../models/schemaTrackingEvent");r.post("/",(0,u.asyncRouteHandler)(async(e,n)=>{const r=a.default.join(t.ROOT_DIR,"XMLs","TrackingEvent.xml"),l=await(0,u.getFileData)(r),m=s.default.getTraversalObj(l,{}),d=s.default.convertToJson(m,{}),g=(0,i.default)(d),f=(0,o.getChilds)(g),{gtmVersion:h,xmlNsOtm:v,xmlNsGtm:p}=(0,u.getXMlVersion)(l);if(!h)return n.status(400).send("XML must contain Namespace");let T=await c.SchemaTrackingEvent.findOne({gtmVersion:h});if(T){if(JSON.stringify(T.ShipmentStatus)===JSON.stringify(f.ShipmentStatus))return n.status(200).send(T);await c.SchemaTrackingEvent.findByIdAndRemove(T._id)}return T=new c.SchemaTrackingEvent({xmlNs:[v,p],gtmVersion:h,...f}),T=await T.save(),n.status(200).send(T)})),r.get("/",(0,u.asyncRouteHandler)(async(e,t)=>{const{gtmVersion:n}=e.query;if(!n){const e=await c.SchemaTrackingEvent.find().sort({gtmVersion:-1});return t.status(200).send(e)}const r=await c.SchemaTrackingEvent.findOne({gtmVersion:n});return r?t.status(200).send(r):t.status(400).send(`gtmVersion:${n} schema not available!`)})),exports.default=r;
},{"./../index":"Focm","../helper/other":"irtd","../helper/TrackingEvent/schemaTrackingEventProps":"e4o2","../models/schemaTrackingEvent":"bLgw"}],"RymQ":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Shipment=void 0;const t=e(require("mongoose")),i=new t.default.Schema({name:String,required:Boolean,disabled:Boolean,display:Boolean,isMandatory:Boolean,type:String,displayText:String,defaultValue:String,gtmVersion:Number,xmlNs:["String"],path:["Mixed"]}),o=(e,o)=>t.default.model("Shipment",i,`${e}_Shipment_${o}`);exports.Shipment=o;
},{}],"Tn9S":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SchemaShipment=void 0;const t=e(require("mongoose")),i=new t.default.Schema({xmlNs:{type:["String"]},gtmVersion:{type:"Number"},ActualShipment:{type:"Mixed"}});exports.SchemaShipment=t.default.model("SchemaShipment",i,"ShipmentSchema");
},{}],"TZ3U":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mapRemark=exports.mapRefnum=exports.mapHeader=void 0;const e=require("../other"),a=require("../renamer"),t=require("../other"),p=["Shipment ID DomainName","Shipment ID","Shipment TransactionCode","Transport Mode ID","Stop Sequence","Location ID DomainName","Location ID","Activity","ShipUnit ID","ShipUnit ID DomainName",...Object.values(t.NAME.shipment)],n=(a,t,p)=>{const n=(0,e.capitalize)(p.split("_").join(" "));return n.split(".")[1]?n.split(".")[1]:n},r=(e,a)=>{return e.findIndex(e=>e.path.search(a)>-1)};for(let o=0;o<e.getSequence.length;o++){e.getSequence[o]}const i=(e,t,n,r,i)=>({name:e.name,required:!0,disabled:(0,a.getMandatoryElement)(e.name,p),display:(0,a.getMandatoryElement)(e.name,p),type:t,displayText:e.name,defaultValue:(0,a.getDefaultValue)(e.path,i),path:[e.path],gtmVersion:n,xmlNs:r});exports.mapHeader=i;const l=(t,p,i,l,m,o,s)=>{const u=r(p,"Xid"),d=r(p,"DomainName"),c=r(p,"RefnumValue"),h=r(p,"TransactionCode");return{name:t,required:!0,disabled:!1,display:!1,type:i,displayText:n(0,0,t),defaultValue:(0,a.getDefaultValue)(p[c].path,s),path:[{path:p[c].path.replace("INDEX",o),value:""},(0,e.getDomainName)(t,p[d].path.replace("INDEX",o)),(0,e.getTC)(t,p[h].path.replace("INDEX",o)),(0,e.getXID)(t,p[u].path.replace("INDEX",o))],gtmVersion:l,xmlNs:m}};exports.mapRefnum=l;const m=(t,p,i,l,m,o,s)=>{const u=r(p,"Xid"),d=r(p,"DomainName"),c=r(p,"RemarkText"),h=r(p,"RemarkSequence"),D=r(p,"TransactionCode");return{name:t,required:!0,disabled:!1,display:!1,type:i,displayText:n(0,0,t),defaultValue:(0,a.getDefaultValue)(p[c].path,s),path:[{path:p[c].path.replace("INDEX",o),value:""},(0,e.getTC)(t,p[D].path.replace("INDEX",o)),(0,e.getSequence)(t,p[h].path.replace("INDEX",o),o),(0,e.getDomainName)(t,p[d].path.replace("INDEX",o)),(0,e.getXID)(t,p[u].path.replace("INDEX",o))],gtmVersion:l,xmlNs:m}};exports.mapRemark=m;
},{"../other":"irtd","../renamer":"jN2X"}],"MdE1":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getUpdatedProp=exports.getShipmentData=exports.getShipmentSchema=void 0;const t=e(require("lodash")),n=e(require("promise-memoize")),a=require("../../models/shipment"),i=require("../../models/schemaShipment"),m=require("./shipmentProps");function r(e,n,a,i){return new Promise(function(r){let{Header:p,Remark:o,Refnum:s}=e.ActualShipment.Shipment,{Header:d}=e.ActualShipment.ShipmentStop,{Header:h}=e.ActualShipment.ShipUnit;const u=e.xmlNs;p=p.map(e=>(0,m.mapHeader)(e,"Shipment : Header",n,u,i)),d=d.map(e=>(0,m.mapHeader)(e,"Shipment Stop : Header",n,u,i)),h=h.map(e=>(0,m.mapHeader)(e,"ShipUnit : Header",n,u,i));const c=a.match(/REMARKS="(.*?)"/)[1].split(",");o=c.map((e,t)=>(0,m.mapRemark)(e,o,"Shipment : Remark",n,u,t,i));const f=a.match(/SHIPMENT_REFNUMS="(.*?)"/)[1].split(",");s=f.map((e,t)=>(0,m.mapRefnum)(e,s,"Shipment : Refnum",n,u,t,i)),r(t.default.uniqBy([...p,...o,...s,...d,...h],e=>e.name))})}function p(e,n,i,m){return new Promise(async function(r){const p=t.default.differenceWith(e,n,(e,t)=>e.name===t.name),o=t.default.differenceWith(n,e,(e,t)=>e.name===t.name);if(p.length>0){const e=await(0,a.Shipment)(m,i).insertMany(p);r([...n,...e])}else o.length>0?(await(0,a.Shipment)(m,i).deleteMany({_id:{$in:[...o.map(e=>e._id)]}}),r(t.default.differenceWith(n,o,(e,t)=>e.name===t.name))):r(n)})}function o(e){return i.SchemaShipment.findOne({gtmVersion:e}).sort({_id:1})}exports.getShipmentSchema=(0,n.default)(o,{maxAge:6e4}),exports.getShipmentData=(0,n.default)(r,{maxAge:6e4}),exports.getUpdatedProp=(0,n.default)(p,{maxAge:6e4});
},{"../../models/shipment":"RymQ","../../models/schemaShipment":"Tn9S","./shipmentProps":"TZ3U"}],"Dxzj":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("express")),a=t.default.Router(),s=require("../helper/other"),r=require("../helper/dbXmlQuery"),n=require("../helper/Shipment/getShipmentData"),i=require("../api/gtm"),u=require("../models/shipment"),d=e(require("../middleware/auth"));a.get("/",[d.default],(0,s.asyncRouteHandler)(async(e,t)=>{const{display:a}=e.query,{username:d,password:o,instance:l,url:p}=e.user,m=d.split(".")[0];if(a){const e=await(0,u.Shipment)(m,l).find({display:a}).sort({_id:1});if(e.length)return t.status(200).json({data:e})}const h=+e.query.gtmVersion||+s.CONSTS.GTMVERSION,c=await(0,n.getShipmentSchema)(h);if(!c)return t.status(400).send(`gtmVersion:${h} schema not available!`);const{data:f,error:y}=await(0,s.asyncHandler)((0,i.dbXml)(p,r.getShipmentPropsfromGtm,d,o));if(y)return t.status(400).send(y);const S=await(0,n.getShipmentData)(c,h,f,m),g=await(0,u.Shipment)(m,l).find({}).sort({_id:1});return g&&0!==g.length?a?t.status(200).json({data:g.filter(e=>e.display)}):t.status(200).json({data:g}):t.status(200).json({data:await(0,u.Shipment)(m,l).insertMany(S)})})),a.put("/",[d.default],(0,s.asyncRouteHandler)(async(e,t)=>{let{shipment:a}=e.body;const{username:s,instance:r}=e.user,n=s.split(".")[0];return a?(a=await(0,u.Shipment)(n,r).findByIdAndUpdate(a._id,a,{new:!0}),t.status(200).json({data:a})):t.status(400).send("Shipment prop value missing!")})),exports.default=a;
},{"../helper/other":"irtd","../helper/dbXmlQuery":"bJb7","../helper/Shipment/getShipmentData":"MdE1","../api/gtm":"KJs0","../models/shipment":"RymQ","../middleware/auth":"MNoc"}],"IbzE":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getChilds=void 0;const t=require("../renamer"),n=e(require("lodash")),a=require("../other"),r=e=>{const t={};return n.default.keys(e).map(e=>i(e,t)).filter(e=>void 0!==e),t},i=(e,t)=>{switch(!0){case-1!==e.search("Remark"):m(e,t,"Remark");break;case-1!==e.search("Refnum"):m(e,t,"Refnum");break;default:m(e,t,"Header")}return t},h=e=>{const t={Shipment:{},ShipmentStop:{},ShipUnit:{}};return n.default.keys(e).map(n=>{switch(!0){case-1===n.search("ActualShipment"):break;case-1!==n.search("ShipmentStop"):p(n,e,t,"ShipmentStop");break;case-1!==n.search("ShipUnit"):p(n,e,t,"ShipUnit");break;default:p(n,e,t,"Shipment")}return t}).filter(e=>void 0!==e),t.Shipment=r(t.Shipment),t.ShipmentStop=r(t.ShipmentStop),t.ShipUnit=r(t.ShipUnit),t.Shipment.ShipmentStop={...t.ShipmentStop},t.Shipment.ShipUnit={...t.ShipUnit},{ActualShipment:t}};exports.getChilds=h;const p=(e,t,n,a)=>{n[`${a}`][`${e}`]=t[`${e}`]},m=(e,r,i)=>{let h=e,p=e;switch(!0){case"Remark"===i:h=(0,a.convertPath)(e,"Remark").newPath,p=(0,a.convertPath)(e,"Remark").newName;break;case"Refnum"===i:h=(0,a.convertPath)(e,"Refnum").newPath,p=(0,a.convertPath)(e,"Refnum").newName}r[`${i}`]||(r[`${i}`]=[]),r[`${i}`].push({name:(0,t.getElementName)(p),path:h}),r[`${i}`]=n.default.uniqBy(r[`${i}`],"name")};
},{"../renamer":"jN2X","../other":"irtd"}],"oS06":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("./../index"),s=e(require("express")),n=s.default.Router(),a=e(require("path")),r=e(require("fast-xml-parser")),i=e(require("flat")),u=require("../helper/other"),m=require("../helper/Shipment/schemaShipmentProps"),o=require("../models/schemaShipment");n.post("/",(0,u.asyncRouteHandler)(async(e,s)=>{const n=a.default.join(t.ROOT_DIR,"XMLs","ActualShipment.xml"),l=await(0,u.getFileData)(n),d=r.default.getTraversalObj(l,{}),c=r.default.convertToJson(d,{}),h=(0,i.default)(c),p=(0,m.getChilds)(h),{gtmVersion:f,xmlNsOtm:S,xmlNsGtm:g}=(0,u.getXMlVersion)(l);if(!f)return s.status(400).send("XML must contain Namespace");let q=await o.SchemaShipment.findOne({gtmVersion:f});if(q){if(JSON.stringify(q.ActualShipment)===JSON.stringify(p.ActualShipment))return s.status(200).send(q);await o.SchemaShipment.findByIdAndRemove(q._id)}return q=new o.SchemaShipment({xmlNs:[S,g],gtmVersion:f,...p}),q=await q.save(),s.status(200).send(q)})),n.get("/",(0,u.asyncRouteHandler)(async(e,t)=>{const{gtmVersion:s}=e.query;if(!s){const e=await o.SchemaShipment.find().sort({gtmVersion:-1});return t.status(200).send(e)}const n=await o.SchemaShipment.findOne({gtmVersion:s});return n?t.status(200).send(n):t.status(400).send(`gtmVersion:${s} schema not available!`)})),exports.default=n;
},{"./../index":"Focm","../helper/other":"irtd","../helper/Shipment/schemaShipmentProps":"IbzE","../models/schemaShipment":"Tn9S"}],"yqlE":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Bom=void 0;const t=e(require("mongoose")),o=new t.default.Schema({name:{type:"String"},required:{type:"Boolean"},disabled:{type:"Boolean"},display:{type:"Boolean"},type:{type:"String"},displayText:{type:"String"},defaultValue:{type:"String"},path:{type:["Mixed"]},xmlNs:{type:["String"]},gtmVersion:{type:"Number"}}),r=(e,r)=>t.default.model("Bom",o,`${e}_Bom_${r}`);exports.Bom=r;
},{}],"fhQn":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SchemaBom=void 0;const t=e(require("mongoose")),o=new t.default.Schema({xmlNs:{type:["String"]},gtmVersion:{type:"Number"},Bom:{type:"Mixed"}});exports.SchemaBom=t.default.model("SchemaBom",o,"BomSchema");
},{}],"d1Ga":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mapInvolvedParty=exports.mapRemark=exports.mapRefnum=exports.mapHeader=void 0;const e=require("../other"),a=require("../renamer"),t=require("../other"),r=["Bom TransactionCode","Bom ID DomainName","Bom ID","Item ID DomainName","Item ID",...Object.values(t.NAME.bom)],p=(a,t,r)=>{const p=(0,e.capitalize)(r.split("_").join(" "));return p.split(".")[1]?p.split(".")[1]:p},n=(e,a)=>{return e.findIndex(e=>e.path.search(a)>-1)};for(let s=0;s<e.getSequence.length;s++){e.getSequence[s]}const l=(e,t,p,n,l)=>({name:e.name,required:!0,disabled:(0,a.getMandatoryElement)(e.name,r),display:(0,a.getMandatoryElement)(e.name,r),type:t,displayText:e.name,defaultValue:(0,a.getDefaultValue)(e.path,l),path:[e.path],gtmVersion:p,xmlNs:n});exports.mapHeader=l;const m=(t,r,l,m,i,o,s,d)=>{const u=n(r,"Xid"),c=n(r,"DomainName"),h=n(r,"RefnumValue"),D=n(r,"TransactionCode");return{name:`${s} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:l,displayText:`${s} ${p(0,0,t)}`.trim(),defaultValue:(0,a.getDefaultValue)(r[h].path,d),path:[{path:r[h].path.replace("INDEX",o),value:""},(0,e.getDomainName)(t,r[c].path.replace("INDEX",o)),(0,e.getTC)(t,r[D].path.replace("INDEX",o)),(0,e.getXID)(t,r[u].path.replace("INDEX",o))],gtmVersion:m,xmlNs:i}};exports.mapRefnum=m;const i=(t,r,l,m,i,o,s,d)=>{const u=n(r,"Xid"),c=n(r,"DomainName"),h=n(r,"RemarkText"),D=n(r,"RemarkSequence"),I=n(r,"TransactionCode");return{name:`${s} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:l,displayText:`${s} ${p(0,0,t)}`.trim(),defaultValue:(0,a.getDefaultValue)(r[h].path,d),path:[{path:r[h].path.replace("INDEX",o),value:""},(0,e.getTC)(t,r[I].path.replace("INDEX",o)),(0,e.getSequence)(t,r[D].path.replace("INDEX",o),o),(0,e.getDomainName)(t,r[c].path.replace("INDEX",o)),(0,e.getXID)(t,r[u].path.replace("INDEX",o))],gtmVersion:m,xmlNs:i}};exports.mapRemark=i;const o=(t,r,l,m,i,o,s,d="")=>{const u=n(r,/InvolvedPartyQualifierGid(.*?)Xid/),c=n(r,/ContactGid(.*?)Xid/),h=n(r,/ContactGid(.*?)DomainName/),D=n(r,"TransactionCode");return{name:`${s} ${t} Contact ID`.trim(),required:!0,disabled:!1,display:!1,type:l,displayText:`${s} ${p(0,0,t)} Contact ID`.trim(),defaultValue:(0,a.getDefaultValue)(r[c].path,d),path:[{path:r[c].path,value:""},(0,e.getTC)(t,r[D].path),{path:r[h].path,value:d},(0,e.getXID)(t,r[u].path)],gtmVersion:m,xmlNs:i}};exports.mapInvolvedParty=o;
},{"../other":"irtd","../renamer":"jN2X"}],"KGb3":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getUpdatedProp=exports.getBomData=exports.getBomSchema=void 0;const m=e(require("lodash")),t=e(require("promise-memoize")),o=require("../../models/bom"),a=require("../../models/schemaBom"),n=require("./bomProps");function r(e,t,o,a){return new Promise(function(r){let{Header:i,Remark:p,Refnum:s,InvolvedParty:d}=e.Bom.Bom,{Header:u,Remark:f,Refnum:c}=e.Bom.BomComponent;const l=e.xmlNs;i=i.map(e=>(0,n.mapHeader)(e,"Bom : Header",t,l,a)),u=u.map(e=>(0,n.mapHeader)(e,"Bom Component : Header",t,l,a));const B=o.match(/REMARKS="(.*?)"/)[1].split(",");p=B.map((e,m)=>(0,n.mapRemark)(e,p,"Bom : Remark",t,l,m,"",a)),f=B.map((e,m)=>(0,n.mapRemark)(e,f,"Bom Component : Remark",t,l,m,"Component",a));const R=o.match(/REFNUMS="(.*?)"/)[1].split(",");s=R.map((e,m)=>(0,n.mapRefnum)(e,s,"Bom : Refnum",t,l,m,"",a));const h=o.match(/COMPONENT_REFNUMS="(.*?)"/)[1].split(",");c=h.map((e,m)=>(0,n.mapRefnum)(e,c,"Bom Component : Refnum",t,l,m,"Component",a));const g=o.match(/INVOLVED_PARTY="(.*?)"/)[1].split(",");d=g.map((e,m)=>(0,n.mapInvolvedParty)(e,d,"Bom : Involved Party",t,l,m,"",a)),r(m.default.uniqBy([...i,...p,...s,...d,...u,...f,...c],e=>e.name))})}function i(e,t,a,n){return new Promise(async function(r){const i=m.default.differenceWith(e,t,(e,m)=>e.name===m.name),p=m.default.differenceWith(t,e,(e,m)=>e.name===m.name);if(i.length>0){const e=await(0,o.Bom)(n,a).insertMany(i);r([...t,...e])}else p.length>0?(await(0,o.Bom)(n,a).deleteMany({_id:{$in:[...p.map(e=>e._id)]}}),r(m.default.differenceWith(t,p,(e,m)=>e.name===m.name))):r(t)})}function p(e){return a.SchemaBom.findOne({gtmVersion:e}).sort({_id:1})}exports.getBomSchema=(0,t.default)(p,{maxAge:6e4}),exports.getBomData=(0,t.default)(r,{maxAge:6e4}),exports.getUpdatedProp=(0,t.default)(i,{maxAge:6e4});
},{"../../models/bom":"yqlE","../../models/schemaBom":"fhQn","./bomProps":"d1Ga"}],"jRt1":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getChilds=void 0;const t=require("../renamer"),r=e(require("lodash")),a=require("../other"),n=e=>{const t={};return r.default.keys(e).map(e=>o(e,t)).filter(e=>void 0!==e),t},o=(e,t)=>{switch(!0){case-1!==e.search("InvolvedParty"):c(e,t,"InvolvedParty");break;case-1!==e.search("Remark"):c(e,t,"Remark");break;case-1!==e.search("Refnum"):c(e,t,"Refnum");break;default:c(e,t,"Header")}return t},m=e=>{const t={Bom:{},BomComponent:{}};return r.default.keys(e).map(r=>{switch(!0){case-1===r.search("GtmStructure"):break;case-1!==r.search("GtmStructureComponent"):s(r,e,t,"BomComponent");break;default:s(r,e,t,"Bom")}return t}).filter(e=>void 0!==e),t.Bom=n(t.Bom),t.BomComponent=n(t.BomComponent),{Bom:t}};exports.getChilds=m;const s=(e,t,r,a)=>{r[`${a}`][`${e}`]=t[`${e}`]},c=(e,n,o)=>{let m=e,s=e;switch(!0){case"InvolvedParty"===o:m=(0,a.convertPath)(e,"InvolvedParty").newPath,s=(0,a.convertPath)(e,"InvolvedParty").newName;break;case"Remark"===o:m=(0,a.convertPath)(e,"Remark").newPath,s=(0,a.convertPath)(e,"Remark").newName;break;case"Refnum"===o:m=(0,a.convertPath)(e,"Refnum").newPath,s=(0,a.convertPath)(e,"Refnum").newName}n[`${o}`]||(n[`${o}`]=[]),n[`${o}`].push({name:(0,t.getElementName)(s),path:m}),n[`${o}`]=r.default.uniqBy(n[`${o}`],"name")};
},{"../renamer":"jN2X","../other":"irtd"}],"Rmix":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.generateBomSchema=void 0;const t=require("./../index"),s=e(require("express")),r=s.default.Router(),a=e(require("path")),n=e(require("fast-xml-parser")),o=e(require("flat")),i=require("../helper/other"),m=require("../helper/Bom/schemaBomProps"),u=require("../models/schemaBom");async function l(){const e=a.default.join(t.ROOT_DIR,"XMLs","GtmStructure.xml"),s=await(0,i.getFileData)(e),r=n.default.getTraversalObj(s,{}),l=n.default.convertToJson(r,{}),d=(0,o.default)(l),c=(0,m.getChilds)(d);let{gtmVersion:f,xmlNsOtm:g,xmlNsGtm:h}=(0,i.getXMlVersion)(s);return f||(f=Number(i.CONSTS.GTMVERSION)),new u.SchemaBom({xmlNs:[g,h],gtmVersion:f,...c}).save()}r.post("/",(0,i.asyncRouteHandler)(async(e,s)=>{const r=a.default.join(t.ROOT_DIR,"XMLs","GtmStructure.xml"),l=await(0,i.getFileData)(r),d=n.default.getTraversalObj(l,{}),c=n.default.convertToJson(d,{}),f=(0,o.default)(c),g=(0,m.getChilds)(f),{gtmVersion:h,xmlNsOtm:x,xmlNsGtm:O}=(0,i.getXMlVersion)(l);if(!h)return s.status(400).send("XML must contain Namespace");let S=await u.SchemaBom.findOne({gtmVersion:h});if(S){if(JSON.stringify(S.Bom)===JSON.stringify(g.Bom))return s.status(200).send(S);await u.SchemaBom.findByIdAndRemove(S._id)}return S=new u.SchemaBom({xmlNs:[x,O],gtmVersion:h,...g}),S=await S.save(),s.status(200).send(S)})),r.get("/",(0,i.asyncRouteHandler)(async(e,t)=>{const{gtmVersion:s}=e.query;if(!s){const e=await u.SchemaBom.find().sort({gtmVersion:-1});return t.status(200).send(e)}const r=await u.SchemaBom.findOne({gtmVersion:s});return r?t.status(200).send(r):t.status(400).send(`gtmVersion:${s} schema not available!`)})),exports.default=r,exports.generateBomSchema=l;
},{"./../index":"Focm","../helper/other":"irtd","../helper/Bom/schemaBomProps":"jRt1","../models/schemaBom":"fhQn"}],"ZKMQ":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("express")),a=t.default.Router(),r=require("../helper/other"),s=require("../helper/dbXmlQuery"),n=require("../helper/Bom/getBomData"),o=require("../api/gtm"),i=require("../models/bom"),u=e(require("../middleware/auth")),d=require("./schemaBom");function l(e){return e.query.gtmVersion?+e.query.gtmVersion:+r.CONSTS.GTMVERSION}a.get("/",[u.default],(0,r.asyncRouteHandler)(async(e,t)=>{const{display:a}=e.query,{username:u,password:m,instance:p,url:c}=e.user,f=u.split(".")[0];if(a){const e=await(0,i.Bom)(f,p).find({display:a}).sort({_id:1});if(e.length)return t.status(200).json({data:e})}const y=l(e);let g=await(0,n.getBomSchema)(y);g||(g=await(0,d.generateBomSchema)());const{data:B,error:h}=await(0,r.asyncHandler)((0,o.dbXml)(c,s.getBomPropsfromGtm,u,m));if(h)return t.status(400).send(h);const w=await(0,n.getBomData)(g,y,B,f);let q=await(0,i.Bom)(f,p).find({}).sort({_id:1});return q&&0!==q.length?(q=await(0,n.getUpdatedProp)(w,q,p,f),a?t.status(200).json({data:q.filter(e=>e.display)}):t.status(200).json({data:q})):t.status(200).json({data:await(0,i.Bom)(f,p).insertMany(w)})})),a.put("/",[u.default],(0,r.asyncRouteHandler)(async(e,t)=>{let{bom:a}=e.body;const{username:r,instance:s}=e.user,n=r.split(".")[0];return a?(a=await(0,i.Bom)(n,s).findByIdAndUpdate(a._id,a,{new:!0}),t.status(200).json({data:a})):t.status(400).send("Bom prop value missing!")})),exports.default=a;
},{"../helper/other":"irtd","../helper/dbXmlQuery":"bJb7","../helper/Bom/getBomData":"KGb3","../api/gtm":"KJs0","../models/bom":"yqlE","../middleware/auth":"MNoc","./schemaBom":"Rmix"}],"BW02":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const r=e(require("body-parser")),u=e(require("../routes/auth")),a=e(require("../routes/user")),t=e(require("../routes/transmission")),s=e(require("../routes/orderRelease")),i=e(require("../middleware/error")),o=e(require("../routes/schemaItem")),d=e(require("../routes/schemaRelease")),l=e(require("../routes/item")),n=e(require("../routes/location")),m=e(require("../routes/schemaLocation")),c=e(require("../routes/party")),p=e(require("../routes/schemaParty")),f=e(require("../routes/transaction")),h=e(require("../routes/schemaTransaction")),q=e(require("../routes/orderBase")),b=e(require("../routes/schemaOrderBase")),g=e(require("../routes/audit")),v=e(require("../routes/setting")),y=e(require("../routes/trackingEvent")),_=e(require("../routes/schemaTrackingEvent")),k=e(require("../routes/shipment")),x=e(require("../routes/schemaShipment")),B=e(require("../routes/bom")),j=e(require("../routes/schemaBom"));function E(e){e.use(r.default.json({limit:"50mb"})),e.use(r.default.urlencoded({limit:"50mb",extended:!0})),e.use("/api/auth",u.default),e.use("/api/user",a.default),e.use("/api/audit",g.default),e.use("/api/item",l.default),e.use("/api/order-release",s.default),e.use("/api/location",n.default),e.use("/api/party",c.default),e.use("/api/bom",B.default),e.use("/api/transaction",f.default),e.use("/api/order-base",q.default),e.use("/api/tracking-event",y.default),e.use("/api/shipment",k.default),e.use("/api/schema/item",o.default),e.use("/api/schema/order-release",d.default),e.use("/api/schema/location",m.default),e.use("/api/schema/party",p.default),e.use("/api/schema/bom",j.default),e.use("/api/schema/transaction",h.default),e.use("/api/schema/order-base",b.default),e.use("/api/schema/tracking-event",_.default),e.use("/api/schema/shipment",x.default),e.use("/api/transmission",t.default),e.use("/api/settings",v.default),e.use(i.default)}exports.default=E;
},{"../routes/auth":"hXw8","../routes/user":"zMRv","../routes/transmission":"oAdS","../routes/orderRelease":"aCHs","../middleware/error":"mbXe","../routes/schemaItem":"RPHv","../routes/schemaRelease":"woBX","../routes/item":"o5f2","../routes/location":"pk3O","../routes/schemaLocation":"ZmvT","../routes/party":"TT7J","../routes/schemaParty":"abiS","../routes/transaction":"F2tt","../routes/schemaTransaction":"DV7a","../routes/orderBase":"Xt3B","../routes/schemaOrderBase":"KJCd","../routes/audit":"YYHk","../routes/setting":"UddP","../routes/trackingEvent":"J2kM","../routes/schemaTrackingEvent":"WFgW","../routes/shipment":"Dxzj","../routes/schemaShipment":"oS06","../routes/bom":"ZKMQ","../routes/schemaBom":"Rmix"}],"K5BP":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("winston")),o=e(require("mongoose")),n=require("../helper/other");function r(){const e=n.CONSTS.DB;o.default.connect(e,{useNewUrlParser:!0,useCreateIndex:!0,useFindAndModify:!1,useUnifiedTopology:!0}).then(()=>t.default.info(`Connected to ${e}...`))}exports.default=r;
},{"../helper/other":"irtd"}],"GM52":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../helper/other");function r(){if(!e.CONSTS.JWT_PRIVATE_KEY)throw new Error("FATAL ERROR: jwtPrivateKey is not defined.")}exports.default=r;
},{"../helper/other":"irtd"}],"Q010":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),t=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(r){if(r&&r.__esModule)return r;var i={};if(null!=r)for(var n in r)"default"!==n&&Object.prototype.hasOwnProperty.call(r,n)&&e(i,r,n);return t(i,r),i},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const n=r(require("joi")),o=i(require("joi-objectid"));function u(){n.objectId=(0,o.default)(n)}exports.default=u;
},{}],"uPYR":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("helmet")),u=e(require("compression"));function r(e){e.use((0,t.default)()),e.use((0,u.default)())}exports.default=r;
},{}],"DxCk":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const r=e(require("./logging")),t=e(require("./routes")),u=e(require("./db")),i=e(require("./config")),d=e(require("./validation")),l=e(require("./prod"));exports.default=(e=>{(0,r.default)(),(0,t.default)(e),(0,u.default)(),(0,i.default)(),(0,d.default)(),(0,l.default)(e)});
},{"./logging":"yaW9","./routes":"BW02","./db":"K5BP","./config":"GM52","./validation":"Q010","./prod":"uPYR"}],"Focm":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ROOT_DIR=void 0;const t=e(require("winston")),r=e(require("express")),u=e(require("cors")),i=e(require("./startup")),s=e(require("body-parser")),n=e(require("path")),o=(0,r.default)();o.use((0,u.default)()),o.use(s.default.json()),(0,i.default)(o),o.use(r.default.static(n.default.join(__dirname,"public"))),o.get("*",(e,t)=>t.sendFile(n.default.join(__dirname,"public","index.html")));const a=process.env.PORT||6e3,d=o.listen(a,l());function l(){return()=>t.default.info(`Listening on port ${a}...`)}exports.default=d,exports.ROOT_DIR=__dirname;
},{"./startup":"DxCk"}]},{},["Focm"], null)